

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>optparse &mdash; PyFoam 0.6.6 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic|Roboto+Slab:400,700|Inconsolata:400,700&subset=latin,cyrillic' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="PyFoam 0.6.6 documentation" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        
          <a href="../index.html" class="fa fa-home"> PyFoam</a>
        
        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../api/modules.html">API documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/PyFoam.html">PyFoam package</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">PyFoam</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Module code</a> &raquo;</li>
      
    <li>optparse</li>
      <li class="wy-breadcrumbs-aside">
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <h1>Source code for optparse</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;A powerful, extensible, and easy-to-use option parser.</span>

<span class="sd">By Greg Ward &lt;gward@python.net&gt;</span>

<span class="sd">Originally distributed as Optik.</span>

<span class="sd">For support, use the optik-users@lists.sourceforge.net mailing list</span>
<span class="sd">(http://lists.sourceforge.net/lists/listinfo/optik-users).</span>

<span class="sd">Simple usage example:</span>

<span class="sd">   from optparse import OptionParser</span>

<span class="sd">   parser = OptionParser()</span>
<span class="sd">   parser.add_option(&quot;-f&quot;, &quot;--file&quot;, dest=&quot;filename&quot;,</span>
<span class="sd">                     help=&quot;write report to FILE&quot;, metavar=&quot;FILE&quot;)</span>
<span class="sd">   parser.add_option(&quot;-q&quot;, &quot;--quiet&quot;,</span>
<span class="sd">                     action=&quot;store_false&quot;, dest=&quot;verbose&quot;, default=True,</span>
<span class="sd">                     help=&quot;don&#39;t print status messages to stdout&quot;)</span>

<span class="sd">   (options, args) = parser.parse_args()</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s">&quot;1.5.3&quot;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Option&#39;</span><span class="p">,</span>
           <span class="s">&#39;make_option&#39;</span><span class="p">,</span>
           <span class="s">&#39;SUPPRESS_HELP&#39;</span><span class="p">,</span>
           <span class="s">&#39;SUPPRESS_USAGE&#39;</span><span class="p">,</span>
           <span class="s">&#39;Values&#39;</span><span class="p">,</span>
           <span class="s">&#39;OptionContainer&#39;</span><span class="p">,</span>
           <span class="s">&#39;OptionGroup&#39;</span><span class="p">,</span>
           <span class="s">&#39;OptionParser&#39;</span><span class="p">,</span>
           <span class="s">&#39;HelpFormatter&#39;</span><span class="p">,</span>
           <span class="s">&#39;IndentedHelpFormatter&#39;</span><span class="p">,</span>
           <span class="s">&#39;TitledHelpFormatter&#39;</span><span class="p">,</span>
           <span class="s">&#39;OptParseError&#39;</span><span class="p">,</span>
           <span class="s">&#39;OptionError&#39;</span><span class="p">,</span>
           <span class="s">&#39;OptionConflictError&#39;</span><span class="p">,</span>
           <span class="s">&#39;OptionValueError&#39;</span><span class="p">,</span>
           <span class="s">&#39;BadOptionError&#39;</span><span class="p">]</span>

<span class="n">__copyright__</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="s">Copyright (c) 2001-2006 Gregory P. Ward.  All rights reserved.</span>
<span class="s">Copyright (c) 2002-2006 Python Software Foundation.  All rights reserved.</span>

<span class="s">Redistribution and use in source and binary forms, with or without</span>
<span class="s">modification, are permitted provided that the following conditions are</span>
<span class="s">met:</span>

<span class="s">  * Redistributions of source code must retain the above copyright</span>
<span class="s">    notice, this list of conditions and the following disclaimer.</span>

<span class="s">  * Redistributions in binary form must reproduce the above copyright</span>
<span class="s">    notice, this list of conditions and the following disclaimer in the</span>
<span class="s">    documentation and/or other materials provided with the distribution.</span>

<span class="s">  * Neither the name of the author nor the names of its</span>
<span class="s">    contributors may be used to endorse or promote products derived from</span>
<span class="s">    this software without specific prior written permission.</span>

<span class="s">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS</span>
<span class="s">IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED</span>
<span class="s">TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A</span>
<span class="s">PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR OR</span>
<span class="s">CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span>
<span class="s">EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span>
<span class="s">PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span>
<span class="s">PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span>
<span class="s">LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span>
<span class="s">NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<span class="s">SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="s">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">textwrap</span>

<span class="k">def</span> <span class="nf">_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;&lt;</span><span class="si">%s</span><span class="s"> at 0x</span><span class="si">%x</span><span class="s">: </span><span class="si">%s</span><span class="s">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="nb">id</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="p">)</span>


<span class="c"># This file was generated from:</span>
<span class="c">#   Id: option_parser.py 527 2006-07-23 15:21:30Z greg</span>
<span class="c">#   Id: option.py 522 2006-06-11 16:22:03Z gward</span>
<span class="c">#   Id: help.py 527 2006-07-23 15:21:30Z greg</span>
<span class="c">#   Id: errors.py 509 2006-04-20 00:58:24Z gward</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">gettext</span> <span class="kn">import</span> <span class="n">gettext</span><span class="p">,</span> <span class="n">ngettext</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">gettext</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">message</span>

    <span class="k">def</span> <span class="nf">ngettext</span><span class="p">(</span><span class="n">singular</span><span class="p">,</span> <span class="n">plural</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">singular</span>
        <span class="k">return</span> <span class="n">plural</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">gettext</span>


<span class="k">class</span> <span class="nc">OptParseError</span> <span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span>


<span class="k">class</span> <span class="nc">OptionError</span> <span class="p">(</span><span class="n">OptParseError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raised if an Option instance is created with invalid or</span>
<span class="sd">    inconsistent arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">option_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;option </span><span class="si">%s</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">option_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">msg</span>

<span class="k">class</span> <span class="nc">OptionConflictError</span> <span class="p">(</span><span class="n">OptionError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raised if conflicting options are added to an OptionParser.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">OptionValueError</span> <span class="p">(</span><span class="n">OptParseError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raised if an invalid option value is encountered on the command</span>
<span class="sd">    line.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">BadOptionError</span> <span class="p">(</span><span class="n">OptParseError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raised if an invalid option is seen on the command line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt_str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt_str</span> <span class="o">=</span> <span class="n">opt_str</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;no such option: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_str</span>

<span class="k">class</span> <span class="nc">AmbiguousOptionError</span> <span class="p">(</span><span class="n">BadOptionError</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raised if an ambiguous option is seen on the command line.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt_str</span><span class="p">,</span> <span class="n">possibilities</span><span class="p">):</span>
        <span class="n">BadOptionError</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt_str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">possibilities</span> <span class="o">=</span> <span class="n">possibilities</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;ambiguous option: </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">?)&quot;</span><span class="p">)</span>
                <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt_str</span><span class="p">,</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">possibilities</span><span class="p">)))</span>


<span class="k">class</span> <span class="nc">HelpFormatter</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract base class for formatting option help.  OptionParser</span>
<span class="sd">    instances should use one of the HelpFormatter subclasses for</span>
<span class="sd">    formatting help; by default IndentedHelpFormatter is used.</span>

<span class="sd">    Instance attributes:</span>
<span class="sd">      parser : OptionParser</span>
<span class="sd">        the controlling OptionParser instance</span>
<span class="sd">      indent_increment : int</span>
<span class="sd">        the number of columns to indent per nesting level</span>
<span class="sd">      max_help_position : int</span>
<span class="sd">        the maximum starting column for option help text</span>
<span class="sd">      help_position : int</span>
<span class="sd">        the calculated starting column for option help text;</span>
<span class="sd">        initially the same as the maximum</span>
<span class="sd">      width : int</span>
<span class="sd">        total number of columns for output (pass None to constructor for</span>
<span class="sd">        this value to be taken from the $COLUMNS environment variable)</span>
<span class="sd">      level : int</span>
<span class="sd">        current indentation level</span>
<span class="sd">      current_indent : int</span>
<span class="sd">        current indentation level (in columns)</span>
<span class="sd">      help_width : int</span>
<span class="sd">        number of columns available for option help text (calculated)</span>
<span class="sd">      default_tag : str</span>
<span class="sd">        text to replace with each option&#39;s default value, &quot;%default&quot;</span>
<span class="sd">        by default.  Set to false value to disable default value expansion.</span>
<span class="sd">      option_strings : { Option : str }</span>
<span class="sd">        maps Option instances to the snippet of help text explaining</span>
<span class="sd">        the syntax of that option, e.g. &quot;-h, --help&quot; or</span>
<span class="sd">        &quot;-fFILE, --file=FILE&quot;</span>
<span class="sd">      _short_opt_fmt : str</span>
<span class="sd">        format string controlling how short options with values are</span>
<span class="sd">        printed in help text.  Must be either &quot;%s%s&quot; (&quot;-fFILE&quot;) or</span>
<span class="sd">        &quot;%s %s&quot; (&quot;-f FILE&quot;), because those are the two syntaxes that</span>
<span class="sd">        Optik supports.</span>
<span class="sd">      _long_opt_fmt : str</span>
<span class="sd">        similar but for long options; must be either &quot;%s %s&quot; (&quot;--file FILE&quot;)</span>
<span class="sd">        or &quot;%s=%s&quot; (&quot;--file=FILE&quot;).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">NO_DEFAULT_VALUE</span> <span class="o">=</span> <span class="s">&quot;none&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">indent_increment</span><span class="p">,</span>
                 <span class="n">max_help_position</span><span class="p">,</span>
                 <span class="n">width</span><span class="p">,</span>
                 <span class="n">short_first</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent_increment</span> <span class="o">=</span> <span class="n">indent_increment</span>
        <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;COLUMNS&#39;</span><span class="p">])</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="n">width</span> <span class="o">=</span> <span class="mi">80</span>
            <span class="n">width</span> <span class="o">-=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_help_position</span> <span class="o">=</span> \
                <span class="nb">min</span><span class="p">(</span><span class="n">max_help_position</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span> <span class="n">indent_increment</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_indent</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help_width</span> <span class="o">=</span> <span class="bp">None</span>          <span class="c"># computed later</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">short_first</span> <span class="o">=</span> <span class="n">short_first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default_tag</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">efault&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">option_strings</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_short_opt_fmt</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_long_opt_fmt</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">=</span><span class="si">%s</span><span class="s">&quot;</span>

    <span class="k">def</span> <span class="nf">set_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">parser</span>

    <span class="k">def</span> <span class="nf">set_short_opt_delimiter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delim</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">delim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s">&quot;invalid metavar delimiter for short options: </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">delim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_short_opt_fmt</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">delim</span> <span class="o">+</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span>

    <span class="k">def</span> <span class="nf">set_long_opt_delimiter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delim</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">delim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;=&quot;</span><span class="p">,</span> <span class="s">&quot; &quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s">&quot;invalid metavar delimiter for long options: </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">delim</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_long_opt_fmt</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">+</span> <span class="n">delim</span> <span class="o">+</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span>

    <span class="k">def</span> <span class="nf">indent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_indent</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent_increment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">dedent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_indent</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent_increment</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_indent</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;Indent decreased below 0.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">format_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usage</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;subclasses must implement&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format_heading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heading</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s">&quot;subclasses must implement&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_format_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Format a paragraph of free-form text for inclusion in the</span>
<span class="sd">        help output at the current indentation level.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">text_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_indent</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>
        <span class="n">indent</span> <span class="o">=</span> <span class="s">&quot; &quot;</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">current_indent</span>
        <span class="k">return</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">text</span><span class="p">,</span>
                             <span class="n">text_width</span><span class="p">,</span>
                             <span class="n">initial_indent</span><span class="o">=</span><span class="n">indent</span><span class="p">,</span>
                             <span class="n">subsequent_indent</span><span class="o">=</span><span class="n">indent</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">description</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">(</span><span class="n">description</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">format_epilog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epilog</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">epilog</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_text</span><span class="p">(</span><span class="n">epilog</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>


    <span class="k">def</span> <span class="nf">expand_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_tag</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">option</span><span class="o">.</span><span class="n">help</span>

        <span class="n">default_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">dest</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">default_value</span> <span class="ow">is</span> <span class="n">NO_DEFAULT</span> <span class="ow">or</span> <span class="n">default_value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">default_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NO_DEFAULT_VALUE</span>

        <span class="k">return</span> <span class="n">option</span><span class="o">.</span><span class="n">help</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_tag</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">default_value</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">format_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
        <span class="c"># The help for each option consists of two parts:</span>
        <span class="c">#   * the opt strings and metavars</span>
        <span class="c">#     eg. (&quot;-x&quot;, or &quot;-fFILENAME, --file=FILENAME&quot;)</span>
        <span class="c">#   * the user-supplied help string</span>
        <span class="c">#     eg. (&quot;turn on expert mode&quot;, &quot;read data from FILENAME&quot;)</span>
        <span class="c">#</span>
        <span class="c"># If possible, we write both of these on the same line:</span>
        <span class="c">#   -x      turn on expert mode</span>
        <span class="c">#</span>
        <span class="c"># But if the opt string list is too long, we put the help</span>
        <span class="c"># string on a second line, indented to the same column it would</span>
        <span class="c"># start in if it fit on the first line.</span>
        <span class="c">#   -fFILENAME, --file=FILENAME</span>
        <span class="c">#           read data from FILENAME</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_strings</span><span class="p">[</span><span class="n">option</span><span class="p">]</span>
        <span class="n">opt_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_position</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_indent</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">opt_width</span><span class="p">:</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%*s%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_indent</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
            <span class="n">indent_first</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_position</span>
        <span class="k">else</span><span class="p">:</span>                       <span class="c"># start help on same line as opts</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%*s%-*s</span><span class="s">  &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_indent</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">opt_width</span><span class="p">,</span> <span class="n">opts</span><span class="p">)</span>
            <span class="n">indent_first</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">option</span><span class="o">.</span><span class="n">help</span><span class="p">:</span>
            <span class="n">help_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_default</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>
            <span class="n">help_lines</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">help_text</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_width</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%*s%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">indent_first</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">help_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">result</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&quot;</span><span class="si">%*s%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">help_position</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                           <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">help_lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>
        <span class="k">elif</span> <span class="n">opts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">store_option_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">()</span>
        <span class="n">max_len</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="n">option_list</span><span class="p">:</span>
            <span class="n">strings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_option_strings</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">option_strings</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span> <span class="o">=</span> <span class="n">strings</span>
            <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_indent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">parser</span><span class="o">.</span><span class="n">option_groups</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">group</span><span class="o">.</span><span class="n">option_list</span><span class="p">:</span>
                <span class="n">strings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_option_strings</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">option_strings</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span> <span class="o">=</span> <span class="n">strings</span>
                <span class="n">max_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_indent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dedent</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dedent</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help_position</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_help_position</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">help_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">help_position</span><span class="p">,</span> <span class="mi">11</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format_option_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a comma-separated list of option strings &amp; metavariables.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">option</span><span class="o">.</span><span class="n">takes_value</span><span class="p">():</span>
            <span class="n">metavar</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">metavar</span> <span class="ow">or</span> <span class="n">option</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="n">short_opts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_short_opt_fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">sopt</span><span class="p">,</span> <span class="n">metavar</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">sopt</span> <span class="ow">in</span> <span class="n">option</span><span class="o">.</span><span class="n">_short_opts</span><span class="p">]</span>
            <span class="n">long_opts</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_long_opt_fmt</span> <span class="o">%</span> <span class="p">(</span><span class="n">lopt</span><span class="p">,</span> <span class="n">metavar</span><span class="p">)</span>
                         <span class="k">for</span> <span class="n">lopt</span> <span class="ow">in</span> <span class="n">option</span><span class="o">.</span><span class="n">_long_opts</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">short_opts</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">_short_opts</span>
            <span class="n">long_opts</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">_long_opts</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_first</span><span class="p">:</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="n">short_opts</span> <span class="o">+</span> <span class="n">long_opts</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="n">long_opts</span> <span class="o">+</span> <span class="n">short_opts</span>

        <span class="k">return</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">IndentedHelpFormatter</span> <span class="p">(</span><span class="n">HelpFormatter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format help with indented section bodies.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">indent_increment</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                 <span class="n">max_help_position</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
                 <span class="n">width</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">short_first</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">HelpFormatter</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">indent_increment</span><span class="p">,</span> <span class="n">max_help_position</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">short_first</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usage</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;Usage: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">usage</span>

    <span class="k">def</span> <span class="nf">format_heading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heading</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%*s%s</span><span class="s">:</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_indent</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">heading</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">TitledHelpFormatter</span> <span class="p">(</span><span class="n">HelpFormatter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Format help with underlined section headers.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">indent_increment</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">max_help_position</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span>
                 <span class="n">width</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">short_first</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">HelpFormatter</span><span class="o">.</span><span class="n">__init__</span> <span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">indent_increment</span><span class="p">,</span> <span class="n">max_help_position</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">short_first</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usage</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">  </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_heading</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Usage&quot;</span><span class="p">)),</span> <span class="n">usage</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format_heading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">heading</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">heading</span><span class="p">,</span> <span class="s">&quot;=-&quot;</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">heading</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">_parse_num</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">val</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;0x&quot;</span><span class="p">:</span>         <span class="c"># hexadecimal</span>
        <span class="n">radix</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="k">elif</span> <span class="n">val</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;0b&quot;</span><span class="p">:</span>       <span class="c"># binary</span>
        <span class="n">radix</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span> <span class="ow">or</span> <span class="s">&quot;0&quot;</span>            <span class="c"># have to remove &quot;0b&quot; prefix</span>
    <span class="k">elif</span> <span class="n">val</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;0&quot;</span><span class="p">:</span>                <span class="c"># octal</span>
        <span class="n">radix</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="k">else</span><span class="p">:</span>                               <span class="c"># decimal</span>
        <span class="n">radix</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">radix</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_parse_int</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">_parse_num</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>

<span class="n">_builtin_cvt</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;int&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="n">_parse_int</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;integer&quot;</span><span class="p">)),</span>
                 <span class="s">&quot;long&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="n">_parse_int</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;integer&quot;</span><span class="p">)),</span>
                 <span class="s">&quot;float&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;floating-point&quot;</span><span class="p">)),</span>
                 <span class="s">&quot;complex&quot;</span> <span class="p">:</span> <span class="p">(</span><span class="nb">complex</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;complex&quot;</span><span class="p">))</span> <span class="p">}</span>

<span class="k">def</span> <span class="nf">check_builtin</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="p">(</span><span class="n">cvt</span><span class="p">,</span> <span class="n">what</span><span class="p">)</span> <span class="o">=</span> <span class="n">_builtin_cvt</span><span class="p">[</span><span class="n">option</span><span class="o">.</span><span class="n">type</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">cvt</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">OptionValueError</span><span class="p">(</span>
            <span class="n">_</span><span class="p">(</span><span class="s">&quot;option </span><span class="si">%s</span><span class="s">: invalid </span><span class="si">%s</span><span class="s"> value: </span><span class="si">%r</span><span class="s">&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">what</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">check_choice</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">option</span><span class="o">.</span><span class="n">choices</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">repr</span><span class="p">,</span> <span class="n">option</span><span class="o">.</span><span class="n">choices</span><span class="p">))</span>
        <span class="k">raise</span> <span class="n">OptionValueError</span><span class="p">(</span>
            <span class="n">_</span><span class="p">(</span><span class="s">&quot;option </span><span class="si">%s</span><span class="s">: invalid choice: </span><span class="si">%r</span><span class="s"> (choose from </span><span class="si">%s</span><span class="s">)&quot;</span><span class="p">)</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">choices</span><span class="p">))</span>

<span class="c"># Not supplying a default is different from a default of None,</span>
<span class="c"># so we need an explicit &quot;not supplied&quot; value.</span>
<span class="n">NO_DEFAULT</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;NO&quot;</span><span class="p">,</span> <span class="s">&quot;DEFAULT&quot;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Option</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Instance attributes:</span>
<span class="sd">      _short_opts : [string]</span>
<span class="sd">      _long_opts : [string]</span>

<span class="sd">      action : string</span>
<span class="sd">      type : string</span>
<span class="sd">      dest : string</span>
<span class="sd">      default : any</span>
<span class="sd">      nargs : int</span>
<span class="sd">      const : any</span>
<span class="sd">      choices : [string]</span>
<span class="sd">      callback : function</span>
<span class="sd">      callback_args : (any*)</span>
<span class="sd">      callback_kwargs : { string : any }</span>
<span class="sd">      help : string</span>
<span class="sd">      metavar : string</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c"># The list of instance attributes that may be set through</span>
    <span class="c"># keyword args to the constructor.</span>
    <span class="n">ATTRS</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;action&#39;</span><span class="p">,</span>
             <span class="s">&#39;type&#39;</span><span class="p">,</span>
             <span class="s">&#39;dest&#39;</span><span class="p">,</span>
             <span class="s">&#39;default&#39;</span><span class="p">,</span>
             <span class="s">&#39;nargs&#39;</span><span class="p">,</span>
             <span class="s">&#39;const&#39;</span><span class="p">,</span>
             <span class="s">&#39;choices&#39;</span><span class="p">,</span>
             <span class="s">&#39;callback&#39;</span><span class="p">,</span>
             <span class="s">&#39;callback_args&#39;</span><span class="p">,</span>
             <span class="s">&#39;callback_kwargs&#39;</span><span class="p">,</span>
             <span class="s">&#39;help&#39;</span><span class="p">,</span>
             <span class="s">&#39;metavar&#39;</span><span class="p">]</span>

    <span class="c"># The set of actions allowed by option parsers.  Explicitly listed</span>
    <span class="c"># here so the constructor can validate its arguments.</span>
    <span class="n">ACTIONS</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;store&quot;</span><span class="p">,</span>
               <span class="s">&quot;store_const&quot;</span><span class="p">,</span>
               <span class="s">&quot;store_true&quot;</span><span class="p">,</span>
               <span class="s">&quot;store_false&quot;</span><span class="p">,</span>
               <span class="s">&quot;append&quot;</span><span class="p">,</span>
               <span class="s">&quot;append_const&quot;</span><span class="p">,</span>
               <span class="s">&quot;count&quot;</span><span class="p">,</span>
               <span class="s">&quot;callback&quot;</span><span class="p">,</span>
               <span class="s">&quot;help&quot;</span><span class="p">,</span>
               <span class="s">&quot;version&quot;</span><span class="p">)</span>

    <span class="c"># The set of actions that involve storing a value somewhere;</span>
    <span class="c"># also listed just for constructor argument validation.  (If</span>
    <span class="c"># the action is one of these, there must be a destination.)</span>
    <span class="n">STORE_ACTIONS</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;store&quot;</span><span class="p">,</span>
                     <span class="s">&quot;store_const&quot;</span><span class="p">,</span>
                     <span class="s">&quot;store_true&quot;</span><span class="p">,</span>
                     <span class="s">&quot;store_false&quot;</span><span class="p">,</span>
                     <span class="s">&quot;append&quot;</span><span class="p">,</span>
                     <span class="s">&quot;append_const&quot;</span><span class="p">,</span>
                     <span class="s">&quot;count&quot;</span><span class="p">)</span>

    <span class="c"># The set of actions for which it makes sense to supply a value</span>
    <span class="c"># type, ie. which may consume an argument from the command line.</span>
    <span class="n">TYPED_ACTIONS</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;store&quot;</span><span class="p">,</span>
                     <span class="s">&quot;append&quot;</span><span class="p">,</span>
                     <span class="s">&quot;callback&quot;</span><span class="p">)</span>

    <span class="c"># The set of actions which *require* a value type, ie. that</span>
    <span class="c"># always consume an argument from the command line.</span>
    <span class="n">ALWAYS_TYPED_ACTIONS</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;store&quot;</span><span class="p">,</span>
                            <span class="s">&quot;append&quot;</span><span class="p">)</span>

    <span class="c"># The set of actions which take a &#39;const&#39; attribute.</span>
    <span class="n">CONST_ACTIONS</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;store_const&quot;</span><span class="p">,</span>
                     <span class="s">&quot;append_const&quot;</span><span class="p">)</span>

    <span class="c"># The set of known types for option parsers.  Again, listed here for</span>
    <span class="c"># constructor argument validation.</span>
    <span class="n">TYPES</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;string&quot;</span><span class="p">,</span> <span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="s">&quot;long&quot;</span><span class="p">,</span> <span class="s">&quot;float&quot;</span><span class="p">,</span> <span class="s">&quot;complex&quot;</span><span class="p">,</span> <span class="s">&quot;choice&quot;</span><span class="p">)</span>

    <span class="c"># Dictionary of argument checking functions, which convert and</span>
    <span class="c"># validate option arguments according to the option type.</span>
    <span class="c">#</span>
    <span class="c"># Signature of checking functions is:</span>
    <span class="c">#   check(option : Option, opt : string, value : string) -&gt; any</span>
    <span class="c"># where</span>
    <span class="c">#   option is the Option instance calling the checker</span>
    <span class="c">#   opt is the actual option seen on the command-line</span>
    <span class="c">#     (eg. &quot;-a&quot;, &quot;--file&quot;)</span>
    <span class="c">#   value is the option argument seen on the command-line</span>
    <span class="c">#</span>
    <span class="c"># The return value should be in the appropriate Python type</span>
    <span class="c"># for option.type -- eg. an integer if option.type == &quot;int&quot;.</span>
    <span class="c">#</span>
    <span class="c"># If no checker is defined for a type, arguments will be</span>
    <span class="c"># unchecked and remain strings.</span>
    <span class="n">TYPE_CHECKER</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;int&quot;</span>    <span class="p">:</span> <span class="n">check_builtin</span><span class="p">,</span>
                     <span class="s">&quot;long&quot;</span>   <span class="p">:</span> <span class="n">check_builtin</span><span class="p">,</span>
                     <span class="s">&quot;float&quot;</span>  <span class="p">:</span> <span class="n">check_builtin</span><span class="p">,</span>
                     <span class="s">&quot;complex&quot;</span><span class="p">:</span> <span class="n">check_builtin</span><span class="p">,</span>
                     <span class="s">&quot;choice&quot;</span> <span class="p">:</span> <span class="n">check_choice</span><span class="p">,</span>
                   <span class="p">}</span>


    <span class="c"># CHECK_METHODS is a list of unbound method objects; they are called</span>
    <span class="c"># by the constructor, in order, after all attributes are</span>
    <span class="c"># initialized.  The list is created and filled in later, after all</span>
    <span class="c"># the methods are actually defined.  (I just put it here because I</span>
    <span class="c"># like to define and document all class attributes in the same</span>
    <span class="c"># place.)  Subclasses that add another _check_*() method should</span>
    <span class="c"># define their own CHECK_METHODS list that adds their check method</span>
    <span class="c"># to those from this class.</span>
    <span class="n">CHECK_METHODS</span> <span class="o">=</span> <span class="bp">None</span>


    <span class="c"># -- Constructor/initialization methods ----------------------------</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">opts</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">):</span>
        <span class="c"># Set _short_opts, _long_opts attrs from &#39;opts&#39; tuple.</span>
        <span class="c"># Have to be set now, in case no option strings are supplied.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_short_opts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_long_opts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_opt_strings</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_opt_strings</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>

        <span class="c"># Set all other attrs (action, type, etc.) from &#39;attrs&#39; dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_attrs</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>

        <span class="c"># Check all the attributes we just set.  There are lots of</span>
        <span class="c"># complicated interdependencies, but luckily they can be farmed</span>
        <span class="c"># out to the _check_*() methods listed in CHECK_METHODS -- which</span>
        <span class="c"># could be handy for subclasses!  The one thing these all share</span>
        <span class="c"># is that they raise OptionError if they discover a problem.</span>
        <span class="k">for</span> <span class="n">checker</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">CHECK_METHODS</span><span class="p">:</span>
            <span class="n">checker</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_opt_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opts</span><span class="p">):</span>
        <span class="c"># Filter out None because early versions of Optik had exactly</span>
        <span class="c"># one short option and one long option, either of which</span>
        <span class="c"># could be None.</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="p">[</span><span class="n">opt</span> <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">opts</span> <span class="k">if</span> <span class="n">opt</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">opts</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;at least one option string must be supplied&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">opts</span>

    <span class="k">def</span> <span class="nf">_set_opt_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opts</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span>
                    <span class="s">&quot;invalid option string </span><span class="si">%r</span><span class="s">: &quot;</span>
                    <span class="s">&quot;must be at least two characters long&quot;</span> <span class="o">%</span> <span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;-&quot;</span> <span class="ow">and</span> <span class="n">opt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;-&quot;</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span>
                        <span class="s">&quot;invalid short option string </span><span class="si">%r</span><span class="s">: &quot;</span>
                        <span class="s">&quot;must be of the form -x, (x any non-dash char)&quot;</span> <span class="o">%</span> <span class="n">opt</span><span class="p">,</span>
                        <span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_short_opts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;--&quot;</span> <span class="ow">and</span> <span class="n">opt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&quot;-&quot;</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span>
                        <span class="s">&quot;invalid long option string </span><span class="si">%r</span><span class="s">: &quot;</span>
                        <span class="s">&quot;must start with --, followed by non-dash&quot;</span> <span class="o">%</span> <span class="n">opt</span><span class="p">,</span>
                        <span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_long_opts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ATTRS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">attrs</span><span class="p">[</span><span class="n">attr</span><span class="p">])</span>
                <span class="k">del</span> <span class="n">attrs</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attr</span> <span class="o">==</span> <span class="s">&#39;default&#39;</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">NO_DEFAULT</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">attrs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span>
                <span class="s">&quot;invalid keyword arguments: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">attrs</span><span class="p">),</span>
                <span class="bp">self</span><span class="p">)</span>


    <span class="c"># -- Constructor validation methods --------------------------------</span>

    <span class="k">def</span> <span class="nf">_check_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="s">&quot;store&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ACTIONS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span><span class="s">&quot;invalid action: </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ALWAYS_TYPED_ACTIONS</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="c"># The &quot;choices&quot; attribute implies &quot;choice&quot; type.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;choice&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># No type given?  &quot;string&quot; is the most sensible default.</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;string&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Allow type objects or builtin type conversion functions</span>
            <span class="c"># (int, str, etc.) as an alternative to their names.</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">.</span><span class="n">__name__</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s">&quot;str&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s">&quot;string&quot;</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPES</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span><span class="s">&quot;invalid option type: </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPED_ACTIONS</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span>
                    <span class="s">&quot;must not supply a type for action </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_choice</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s">&quot;choice&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span>
                    <span class="s">&quot;must supply a list of choices for type &#39;choice&#39;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span>
                    <span class="s">&quot;choices must be a list of strings (&#39;</span><span class="si">%s</span><span class="s">&#39; supplied)&quot;</span>
                    <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;&#39;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span>
                <span class="s">&quot;must not supply choices for type </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_dest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># No destination given, and we need one for this action.  The</span>
        <span class="c"># self.type check is for callbacks that take a value.</span>
        <span class="n">takes_value</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">STORE_ACTIONS</span> <span class="ow">or</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">takes_value</span><span class="p">:</span>

            <span class="c"># Glean a destination from the first long option string,</span>
            <span class="c"># or from the first short option string if no long options.</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_long_opts</span><span class="p">:</span>
                <span class="c"># eg. &quot;--foo-bar&quot; -&gt; &quot;foo_bar&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_long_opts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_short_opts</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_check_const</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">CONST_ACTIONS</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">const</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span>
                <span class="s">&quot;&#39;const&#39; must not be supplied for action </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">,</span>
                <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_nargs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPED_ACTIONS</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nargs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">nargs</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">nargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span>
                <span class="s">&quot;&#39;nargs&#39; must not be supplied for action </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">,</span>
                <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">==</span> <span class="s">&quot;callback&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span>
                    <span class="s">&quot;callback not callable: </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callback_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callback_args</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span>
                    <span class="s">&quot;callback_args, if supplied, must be a tuple: not </span><span class="si">%r</span><span class="s">&quot;</span>
                    <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback_args</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callback_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span>
                <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">callback_kwargs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span>
                    <span class="s">&quot;callback_kwargs, if supplied, must be a dict: not </span><span class="si">%r</span><span class="s">&quot;</span>
                    <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback_kwargs</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span>
                    <span class="s">&quot;callback supplied (</span><span class="si">%r</span><span class="s">) for non-callback option&quot;</span>
                    <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback_args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span>
                    <span class="s">&quot;callback_args supplied for non-callback option&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">OptionError</span><span class="p">(</span>
                    <span class="s">&quot;callback_kwargs supplied for non-callback option&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>


    <span class="n">CHECK_METHODS</span> <span class="o">=</span> <span class="p">[</span><span class="n">_check_action</span><span class="p">,</span>
                     <span class="n">_check_type</span><span class="p">,</span>
                     <span class="n">_check_choice</span><span class="p">,</span>
                     <span class="n">_check_dest</span><span class="p">,</span>
                     <span class="n">_check_const</span><span class="p">,</span>
                     <span class="n">_check_nargs</span><span class="p">,</span>
                     <span class="n">_check_callback</span><span class="p">]</span>


    <span class="c"># -- Miscellaneous methods -----------------------------------------</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_short_opts</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_long_opts</span><span class="p">)</span>

    <span class="n">__repr__</span> <span class="o">=</span> <span class="n">_repr</span>

    <span class="k">def</span> <span class="nf">takes_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">get_opt_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_long_opts</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_long_opts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_short_opts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


    <span class="c"># -- Processing methods --------------------------------------------</span>

    <span class="k">def</span> <span class="nf">check_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">checker</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">TYPE_CHECKER</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">checker</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">checker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">convert_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nargs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_value</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">tuple</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">check_value</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>

        <span class="c"># First, convert the value(s) to the right type.  Howl if any</span>
        <span class="c"># value(s) are bogus.</span>
        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_value</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c"># And then take whatever action is expected of us.</span>
        <span class="c"># This is a separate method to make life easier for</span>
        <span class="c"># subclasses to add new actions.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_action</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dest</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">parser</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">take_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&quot;store&quot;</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&quot;store_const&quot;</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">const</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&quot;store_true&quot;</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&quot;store_false&quot;</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&quot;append&quot;</span><span class="p">:</span>
            <span class="n">values</span><span class="o">.</span><span class="n">ensure_value</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&quot;append_const&quot;</span><span class="p">:</span>
            <span class="n">values</span><span class="o">.</span><span class="n">ensure_value</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">const</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&quot;count&quot;</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">values</span><span class="o">.</span><span class="n">ensure_value</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&quot;callback&quot;</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback_args</span> <span class="ow">or</span> <span class="p">()</span>
            <span class="n">kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">callback_kwargs</span> <span class="ow">or</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&quot;help&quot;</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&quot;version&quot;</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">print_version</span><span class="p">()</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;unknown action </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">1</span>

<span class="c"># class Option</span>


<span class="n">SUPPRESS_HELP</span> <span class="o">=</span> <span class="s">&quot;SUPPRESS&quot;</span><span class="o">+</span><span class="s">&quot;HELP&quot;</span>
<span class="n">SUPPRESS_USAGE</span> <span class="o">=</span> <span class="s">&quot;SUPPRESS&quot;</span><span class="o">+</span><span class="s">&quot;USAGE&quot;</span>

<span class="k">class</span> <span class="nc">Values</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">)</span>

    <span class="n">__repr__</span> <span class="o">=</span> <span class="n">_repr</span>

    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Values</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">__dict__</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span> <span class="o">==</span> <span class="n">other</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">NotImplemented</span>

    <span class="k">def</span> <span class="nf">_update_careful</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the option values from an arbitrary dictionary, but only</span>
<span class="sd">        use keys from dict that already have a corresponding attribute</span>
<span class="sd">        in self.  Any keys in dict without a corresponding attribute</span>
<span class="sd">        are silently ignored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="n">dval</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">dval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">dval</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update_loose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the option values from an arbitrary dictionary,</span>
<span class="sd">        using all keys from the dictionary regardless of whether</span>
<span class="sd">        they have a corresponding attribute in self or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;careful&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_careful</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s">&quot;loose&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_loose</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;invalid update mode: </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modname</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;careful&quot;</span><span class="p">):</span>
        <span class="nb">__import__</span><span class="p">(</span><span class="n">modname</span><span class="p">)</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">modname</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="n">mod</span><span class="p">),</span> <span class="n">mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">&quot;careful&quot;</span><span class="p">):</span>
        <span class="nb">vars</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">exec</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="nb">vars</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update</span><span class="p">(</span><span class="nb">vars</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ensure_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">OptionContainer</span><span class="p">:</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Abstract base class.</span>

<span class="sd">    Class attributes:</span>
<span class="sd">      standard_option_list : [Option]</span>
<span class="sd">        list of standard options that will be accepted by all instances</span>
<span class="sd">        of this parser class (intended to be overridden by subclasses).</span>

<span class="sd">    Instance attributes:</span>
<span class="sd">      option_list : [Option]</span>
<span class="sd">        the list of Option objects contained by this OptionContainer</span>
<span class="sd">      _short_opt : { string : Option }</span>
<span class="sd">        dictionary mapping short option strings, eg. &quot;-f&quot; or &quot;-X&quot;,</span>
<span class="sd">        to the Option instances that implement them.  If an Option</span>
<span class="sd">        has multiple short option strings, it will appears in this</span>
<span class="sd">        dictionary multiple times. [1]</span>
<span class="sd">      _long_opt : { string : Option }</span>
<span class="sd">        dictionary mapping long option strings, eg. &quot;--file&quot; or</span>
<span class="sd">        &quot;--exclude&quot;, to the Option instances that implement them.</span>
<span class="sd">        Again, a given Option can occur multiple times in this</span>
<span class="sd">        dictionary. [1]</span>
<span class="sd">      defaults : { string : any }</span>
<span class="sd">        dictionary mapping option destination names to default</span>
<span class="sd">        values for each destination [1]</span>

<span class="sd">    [1] These mappings are common to (shared by) all components of the</span>
<span class="sd">        controlling OptionParser, where they are initially created.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_class</span><span class="p">,</span> <span class="n">conflict_handler</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
        <span class="c"># Initialize the option list and related data structures.</span>
        <span class="c"># This method must be provided by subclasses, and it must</span>
        <span class="c"># initialize at least the following instance attributes:</span>
        <span class="c"># option_list, _short_opt, _long_opt, defaults.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_option_list</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">option_class</span> <span class="o">=</span> <span class="n">option_class</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_conflict_handler</span><span class="p">(</span><span class="n">conflict_handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="n">description</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_option_mappings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># For use by OptionParser constructor -- create the master</span>
        <span class="c"># option mappings used by this OptionParser and all</span>
        <span class="c"># OptionGroups that it owns.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_short_opt</span> <span class="o">=</span> <span class="p">{}</span>            <span class="c"># single letter -&gt; Option instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_long_opt</span> <span class="o">=</span> <span class="p">{}</span>             <span class="c"># long option -&gt; Option instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span> <span class="o">=</span> <span class="p">{}</span>              <span class="c"># maps option dest -&gt; default value</span>


    <span class="k">def</span> <span class="nf">_share_option_mappings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="c"># For use by OptionGroup constructor -- use shared option</span>
        <span class="c"># mappings from the OptionParser that owns this OptionGroup.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_short_opt</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">_short_opt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_long_opt</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">_long_opt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">defaults</span>

    <span class="k">def</span> <span class="nf">set_conflict_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">handler</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;error&quot;</span><span class="p">,</span> <span class="s">&quot;resolve&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;invalid conflict_resolution value </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">handler</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conflict_handler</span> <span class="o">=</span> <span class="n">handler</span>

    <span class="k">def</span> <span class="nf">set_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>

    <span class="k">def</span> <span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span>


    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;see OptionParser.destroy().&quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_short_opt</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_long_opt</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span>


    <span class="c"># -- Option-adding methods -----------------------------------------</span>

    <span class="k">def</span> <span class="nf">_check_conflict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
        <span class="n">conflict_opts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">option</span><span class="o">.</span><span class="n">_short_opts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">opt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_short_opt</span><span class="p">:</span>
                <span class="n">conflict_opts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_short_opt</span><span class="p">[</span><span class="n">opt</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">option</span><span class="o">.</span><span class="n">_long_opts</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">opt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_long_opt</span><span class="p">:</span>
                <span class="n">conflict_opts</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_long_opt</span><span class="p">[</span><span class="n">opt</span><span class="p">]))</span>

        <span class="k">if</span> <span class="n">conflict_opts</span><span class="p">:</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conflict_handler</span>
            <span class="k">if</span> <span class="n">handler</span> <span class="o">==</span> <span class="s">&quot;error&quot;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">OptionConflictError</span><span class="p">(</span>
                    <span class="s">&quot;conflicting option string(s): </span><span class="si">%s</span><span class="s">&quot;</span>
                    <span class="o">%</span> <span class="s">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">co</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">co</span> <span class="ow">in</span> <span class="n">conflict_opts</span><span class="p">]),</span>
                    <span class="n">option</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">handler</span> <span class="o">==</span> <span class="s">&quot;resolve&quot;</span><span class="p">:</span>
                <span class="k">for</span> <span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">c_option</span><span class="p">)</span> <span class="ow">in</span> <span class="n">conflict_opts</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">opt</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;--&quot;</span><span class="p">):</span>
                        <span class="n">c_option</span><span class="o">.</span><span class="n">_long_opts</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
                        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_long_opt</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">c_option</span><span class="o">.</span><span class="n">_short_opts</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
                        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_short_opt</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">c_option</span><span class="o">.</span><span class="n">_short_opts</span> <span class="ow">or</span> <span class="n">c_option</span><span class="o">.</span><span class="n">_long_opts</span><span class="p">):</span>
                        <span class="n">c_option</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">option_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">c_option</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;add_option(Option)</span>
<span class="sd">           add_option(opt_str, ..., kwarg=val, ...)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_class</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">option</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">Option</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;not an Option instance: </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">option</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;invalid arguments&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_conflict</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">option_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>
        <span class="n">option</span><span class="o">.</span><span class="n">container</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">option</span><span class="o">.</span><span class="n">_short_opts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_short_opt</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span> <span class="o">=</span> <span class="n">option</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">option</span><span class="o">.</span><span class="n">_long_opts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_long_opt</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span> <span class="o">=</span> <span class="n">option</span>

        <span class="k">if</span> <span class="n">option</span><span class="o">.</span><span class="n">dest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>     <span class="c"># option has a dest, we need a default</span>
            <span class="k">if</span> <span class="n">option</span><span class="o">.</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NO_DEFAULT</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="n">option</span><span class="o">.</span><span class="n">dest</span><span class="p">]</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">default</span>
            <span class="k">elif</span> <span class="n">option</span><span class="o">.</span><span class="n">dest</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="n">option</span><span class="o">.</span><span class="n">dest</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">return</span> <span class="n">option</span>

    <span class="k">def</span> <span class="nf">add_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">option_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>

    <span class="c"># -- Option query/removal methods ----------------------------------</span>

    <span class="k">def</span> <span class="nf">get_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt_str</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_short_opt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">opt_str</span><span class="p">)</span> <span class="ow">or</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_long_opt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">opt_str</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">has_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt_str</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">opt_str</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_short_opt</span> <span class="ow">or</span>
                <span class="n">opt_str</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_long_opt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt_str</span><span class="p">):</span>
        <span class="n">option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_short_opt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">opt_str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">option</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_long_opt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">opt_str</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">option</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;no such option </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">opt_str</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">option</span><span class="o">.</span><span class="n">_short_opts</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_short_opt</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">option</span><span class="o">.</span><span class="n">_long_opts</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_long_opt</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span>
        <span class="n">option</span><span class="o">.</span><span class="n">container</span><span class="o">.</span><span class="n">option_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>


    <span class="c"># -- Help-formatting methods ---------------------------------------</span>

    <span class="k">def</span> <span class="nf">format_option_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formatter</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_list</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">option</span><span class="o">.</span><span class="n">help</span> <span class="ow">is</span> <span class="n">SUPPRESS_HELP</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formatter</span><span class="o">.</span><span class="n">format_option</span><span class="p">(</span><span class="n">option</span><span class="p">))</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formatter</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_description</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">format_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formatter</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_description</span><span class="p">(</span><span class="n">formatter</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_list</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_option_help</span><span class="p">(</span><span class="n">formatter</span><span class="p">))</span>
        <span class="k">return</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">OptionGroup</span> <span class="p">(</span><span class="n">OptionContainer</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parser</span> <span class="o">=</span> <span class="n">parser</span>
        <span class="n">OptionContainer</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="o">.</span><span class="n">option_class</span><span class="p">,</span> <span class="n">parser</span><span class="o">.</span><span class="n">conflict_handler</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>

    <span class="k">def</span> <span class="nf">_create_option_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">option_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_share_option_mappings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parser</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>

    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;see OptionParser.destroy().&quot;&quot;&quot;</span>
        <span class="n">OptionContainer</span><span class="o">.</span><span class="n">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_list</span>

    <span class="c"># -- Help-formatting methods ---------------------------------------</span>

    <span class="k">def</span> <span class="nf">format_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formatter</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format_heading</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">indent</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="n">OptionContainer</span><span class="o">.</span><span class="n">format_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formatter</span><span class="p">)</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">dedent</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>


<span class="k">class</span> <span class="nc">OptionParser</span> <span class="p">(</span><span class="n">OptionContainer</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class attributes:</span>
<span class="sd">      standard_option_list : [Option]</span>
<span class="sd">        list of standard options that will be accepted by all instances</span>
<span class="sd">        of this parser class (intended to be overridden by subclasses).</span>

<span class="sd">    Instance attributes:</span>
<span class="sd">      usage : string</span>
<span class="sd">        a usage string for your program.  Before it is displayed</span>
<span class="sd">        to the user, &quot;%prog&quot; will be expanded to the name of</span>
<span class="sd">        your program (self.prog or os.path.basename(sys.argv[0])).</span>
<span class="sd">      prog : string</span>
<span class="sd">        the name of the current program (to override</span>
<span class="sd">        os.path.basename(sys.argv[0])).</span>
<span class="sd">      description : string</span>
<span class="sd">        A paragraph of text giving a brief overview of your program.</span>
<span class="sd">        optparse reformats this paragraph to fit the current terminal</span>
<span class="sd">        width and prints it when the user requests help (after usage,</span>
<span class="sd">        but before the list of options).</span>
<span class="sd">      epilog : string</span>
<span class="sd">        paragraph of help text to print after option help</span>

<span class="sd">      option_groups : [OptionGroup]</span>
<span class="sd">        list of option groups in this parser (option groups are</span>
<span class="sd">        irrelevant for parsing the command-line, but very useful</span>
<span class="sd">        for generating help)</span>

<span class="sd">      allow_interspersed_args : bool = true</span>
<span class="sd">        if true, positional arguments may be interspersed with options.</span>
<span class="sd">        Assuming -a and -b each take a single argument, the command-line</span>
<span class="sd">          -ablah foo bar -bboo baz</span>
<span class="sd">        will be interpreted the same as</span>
<span class="sd">          -ablah -bboo -- foo bar baz</span>
<span class="sd">        If this flag were false, that command line would be interpreted as</span>
<span class="sd">          -ablah -- foo bar -bboo baz</span>
<span class="sd">        -- ie. we stop processing options as soon as we see the first</span>
<span class="sd">        non-option argument.  (This is the tradition followed by</span>
<span class="sd">        Python&#39;s getopt module, Perl&#39;s Getopt::Std, and other argument-</span>
<span class="sd">        parsing libraries, but it is generally annoying to users.)</span>

<span class="sd">      process_default_values : bool = true</span>
<span class="sd">        if true, option default values are processed similarly to option</span>
<span class="sd">        values from the command line: that is, they are passed to the</span>
<span class="sd">        type-checking function for the option&#39;s type (as long as the</span>
<span class="sd">        default value is a string).  (This really only matters if you</span>
<span class="sd">        have defined custom types; see SF bug #955889.)  Set it to false</span>
<span class="sd">        to restore the behaviour of Optik 1.4.1 and earlier.</span>

<span class="sd">      rargs : [string]</span>
<span class="sd">        the argument list currently being parsed.  Only set when</span>
<span class="sd">        parse_args() is active, and continually trimmed down as</span>
<span class="sd">        we consume arguments.  Mainly there for the benefit of</span>
<span class="sd">        callback options.</span>
<span class="sd">      largs : [string]</span>
<span class="sd">        the list of leftover arguments that we have skipped while</span>
<span class="sd">        parsing options.  If allow_interspersed_args is false, this</span>
<span class="sd">        list is always empty.</span>
<span class="sd">      values : Values</span>
<span class="sd">        the set of option values currently being accumulated.  Only</span>
<span class="sd">        set when parse_args() is active.  Also mainly for callbacks.</span>

<span class="sd">    Because of the &#39;rargs&#39;, &#39;largs&#39;, and &#39;values&#39; attributes,</span>
<span class="sd">    OptionParser is not thread-safe.  If, for some perverse reason, you</span>
<span class="sd">    need to parse command-line arguments simultaneously in different</span>
<span class="sd">    threads, use different OptionParser instances.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">standard_option_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">usage</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">option_list</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">option_class</span><span class="o">=</span><span class="n">Option</span><span class="p">,</span>
                 <span class="n">version</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">conflict_handler</span><span class="o">=</span><span class="s">&quot;error&quot;</span><span class="p">,</span>
                 <span class="n">description</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">formatter</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">add_help_option</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">prog</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">epilog</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">OptionContainer</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">option_class</span><span class="p">,</span> <span class="n">conflict_handler</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_usage</span><span class="p">(</span><span class="n">usage</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prog</span> <span class="o">=</span> <span class="n">prog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_interspersed_args</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_default_values</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">formatter</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="n">IndentedHelpFormatter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="n">formatter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">set_parser</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epilog</span> <span class="o">=</span> <span class="n">epilog</span>

        <span class="c"># Populate the option list; initial sources are the</span>
        <span class="c"># standard_option_list class attribute, the &#39;option_list&#39;</span>
        <span class="c"># argument, and (if applicable) the _add_version_option() and</span>
        <span class="c"># _add_help_option() methods.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_option_list</span><span class="p">(</span><span class="n">option_list</span><span class="p">,</span>
                                   <span class="n">add_help</span><span class="o">=</span><span class="n">add_help_option</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_init_parsing_state</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Declare that you are done with this OptionParser.  This cleans up</span>
<span class="sd">        reference cycles so the OptionParser (and all objects referenced by</span>
<span class="sd">        it) can be garbage-collected promptly.  After calling destroy(), the</span>
<span class="sd">        OptionParser is unusable.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">OptionContainer</span><span class="o">.</span><span class="n">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_groups</span><span class="p">:</span>
            <span class="n">group</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_list</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_groups</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span>


    <span class="c"># -- Private methods -----------------------------------------------</span>
    <span class="c"># (used by our or OptionContainer&#39;s constructor)</span>

    <span class="k">def</span> <span class="nf">_create_option_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">option_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">option_groups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_create_option_mappings</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_add_help_option</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;-h&quot;</span><span class="p">,</span> <span class="s">&quot;--help&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s">&quot;help&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;show this help message and exit&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_add_version_option</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;--version&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s">&quot;version&quot;</span><span class="p">,</span>
                        <span class="n">help</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;show program&#39;s version number and exit&quot;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_populate_option_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option_list</span><span class="p">,</span> <span class="n">add_help</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard_option_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_options</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">standard_option_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">option_list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_options</span><span class="p">(</span><span class="n">option_list</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_version_option</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">add_help</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add_help_option</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_init_parsing_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># These are set in parse_args() for the convenience of callbacks.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rargs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">largs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="bp">None</span>


    <span class="c"># -- Simple modifier methods ---------------------------------------</span>

    <span class="k">def</span> <span class="nf">set_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usage</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">usage</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">usage</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s">&quot;%prog [options]&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">usage</span> <span class="ow">is</span> <span class="n">SUPPRESS_USAGE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">usage</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># For backwards compatibility with Optik 1.3 and earlier.</span>
        <span class="k">elif</span> <span class="n">usage</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;usage: &quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">usage</span> <span class="o">=</span> <span class="n">usage</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">usage</span> <span class="o">=</span> <span class="n">usage</span>

    <span class="k">def</span> <span class="nf">enable_interspersed_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set parsing to not stop on the first non-option, allowing</span>
<span class="sd">        interspersing switches with command arguments. This is the</span>
<span class="sd">        default behavior. See also disable_interspersed_args() and the</span>
<span class="sd">        class documentation description of the attribute</span>
<span class="sd">        allow_interspersed_args.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_interspersed_args</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">disable_interspersed_args</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set parsing to stop on the first non-option. Use this if</span>
<span class="sd">        you have a command processor which runs another command that</span>
<span class="sd">        has options of its own and you want to make sure these options</span>
<span class="sd">        don&#39;t get confused.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_interspersed_args</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">set_process_default_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">process</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">process_default_values</span> <span class="o">=</span> <span class="n">process</span>

    <span class="k">def</span> <span class="nf">set_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">set_defaults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_all_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_list</span><span class="p">[:]</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_groups</span><span class="p">:</span>
            <span class="n">options</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">option_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">options</span>

    <span class="k">def</span> <span class="nf">get_default_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_default_values</span><span class="p">:</span>
            <span class="c"># Old, pre-Optik 1.5 behaviour.</span>
            <span class="k">return</span> <span class="n">Values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="p">)</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaults</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_options</span><span class="p">():</span>
            <span class="n">default</span> <span class="o">=</span> <span class="n">defaults</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">option</span><span class="o">.</span><span class="n">dest</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">opt_str</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">get_opt_string</span><span class="p">()</span>
                <span class="n">defaults</span><span class="p">[</span><span class="n">option</span><span class="o">.</span><span class="n">dest</span><span class="p">]</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">check_value</span><span class="p">(</span><span class="n">opt_str</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Values</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span>


    <span class="c"># -- OptionGroup methods -------------------------------------------</span>

    <span class="k">def</span> <span class="nf">add_option_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c"># XXX lots of overlap with OptionContainer.add_option()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">OptionGroup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">group</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">OptionGroup</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;not an OptionGroup instance: </span><span class="si">%r</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">group</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">group</span><span class="o">.</span><span class="n">parser</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;invalid OptionGroup (wrong parser)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&quot;invalid arguments&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">option_groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">group</span>

    <span class="k">def</span> <span class="nf">get_option_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt_str</span><span class="p">):</span>
        <span class="n">option</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_short_opt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">opt_str</span><span class="p">)</span> <span class="ow">or</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">_long_opt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">opt_str</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">option</span> <span class="ow">and</span> <span class="n">option</span><span class="o">.</span><span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">option</span><span class="o">.</span><span class="n">container</span>
        <span class="k">return</span> <span class="bp">None</span>


    <span class="c"># -- Option-parsing methods ----------------------------------------</span>

    <span class="k">def</span> <span class="nf">_get_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">args</span><span class="p">[:]</span>              <span class="c"># don&#39;t modify caller&#39;s list</span>

    <span class="k">def</span> <span class="nf">parse_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        parse_args(args : [string] = sys.argv[1:],</span>
<span class="sd">                   values : Values = None)</span>
<span class="sd">        -&gt; (values : Values, args : [string])</span>

<span class="sd">        Parse the command-line options found in &#39;args&#39; (default:</span>
<span class="sd">        sys.argv[1:]).  Any errors result in a call to &#39;error()&#39;, which</span>
<span class="sd">        by default prints the usage message to stderr and calls</span>
<span class="sd">        sys.exit() with an error message.  On success returns a pair</span>
<span class="sd">        (values, args) where &#39;values&#39; is an Values instance (with all</span>
<span class="sd">        your option values) and &#39;args&#39; is the list of arguments left</span>
<span class="sd">        over after parsing options.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_values</span><span class="p">()</span>

        <span class="c"># Store the halves of the argument list as attributes for the</span>
        <span class="c"># convenience of callbacks:</span>
        <span class="c">#   rargs</span>
        <span class="c">#     the rest of the command-line (the &quot;r&quot; stands for</span>
        <span class="c">#     &quot;remaining&quot; or &quot;right-hand&quot;)</span>
        <span class="c">#   largs</span>
        <span class="c">#     the leftover arguments -- ie. what&#39;s left after removing</span>
        <span class="c">#     options and their arguments (the &quot;l&quot; stands for &quot;leftover&quot;</span>
        <span class="c">#     or &quot;left-hand&quot;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rargs</span> <span class="o">=</span> <span class="n">rargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">largs</span> <span class="o">=</span> <span class="n">largs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_args</span><span class="p">(</span><span class="n">largs</span><span class="p">,</span> <span class="n">rargs</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">BadOptionError</span><span class="p">,</span> <span class="n">OptionValueError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">largs</span> <span class="o">+</span> <span class="n">rargs</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_values</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        check_values(values : Values, args : [string])</span>
<span class="sd">        -&gt; (values : Values, args : [string])</span>

<span class="sd">        Check that the supplied option values and leftover arguments are</span>
<span class="sd">        valid.  Returns the option values and leftover arguments</span>
<span class="sd">        (possibly adjusted, possibly completely new -- whatever you</span>
<span class="sd">        like).  Default implementation just returns the passed-in</span>
<span class="sd">        values; subclasses may override as desired.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_process_args</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">largs</span><span class="p">,</span> <span class="n">rargs</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_process_args(largs : [string],</span>
<span class="sd">                         rargs : [string],</span>
<span class="sd">                         values : Values)</span>

<span class="sd">        Process command-line arguments and populate &#39;values&#39;, consuming</span>
<span class="sd">        options and arguments from &#39;rargs&#39;.  If &#39;allow_interspersed_args&#39; is</span>
<span class="sd">        false, stop at the first non-option argument.  If true, accumulate any</span>
<span class="sd">        interspersed non-option arguments in &#39;largs&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="n">rargs</span><span class="p">:</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="n">rargs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c"># We handle bare &quot;--&quot; explicitly, and bare &quot;-&quot; is handled by the</span>
            <span class="c"># standard arg handler since the short arg case ensures that the</span>
            <span class="c"># len of the opt string is greater than 1.</span>
            <span class="k">if</span> <span class="n">arg</span> <span class="o">==</span> <span class="s">&quot;--&quot;</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">rargs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">return</span>
            <span class="k">elif</span> <span class="n">arg</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;--&quot;</span><span class="p">:</span>
                <span class="c"># process a single long option (possibly with value(s))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_process_long_opt</span><span class="p">(</span><span class="n">rargs</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">arg</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;-&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c"># process a cluster of short options (possibly with</span>
                <span class="c"># value(s) for the last one only)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_process_short_opts</span><span class="p">(</span><span class="n">rargs</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">allow_interspersed_args</span><span class="p">:</span>
                <span class="n">largs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">rargs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span>                  <span class="c"># stop now, leave this arg in rargs</span>

        <span class="c"># Say this is the original argument list:</span>
        <span class="c"># [arg0, arg1, ..., arg(i-1), arg(i), arg(i+1), ..., arg(N-1)]</span>
        <span class="c">#                            ^</span>
        <span class="c"># (we are about to process arg(i)).</span>
        <span class="c">#</span>
        <span class="c"># Then rargs is [arg(i), ..., arg(N-1)] and largs is a *subset* of</span>
        <span class="c"># [arg0, ..., arg(i-1)] (any options and their arguments will have</span>
        <span class="c"># been removed from largs).</span>
        <span class="c">#</span>
        <span class="c"># The while loop will usually consume 1 or more arguments per pass.</span>
        <span class="c"># If it consumes 1 (eg. arg is an option that takes no arguments),</span>
        <span class="c"># then after _process_arg() is done the situation is:</span>
        <span class="c">#</span>
        <span class="c">#   largs = subset of [arg0, ..., arg(i)]</span>
        <span class="c">#   rargs = [arg(i+1), ..., arg(N-1)]</span>
        <span class="c">#</span>
        <span class="c"># If allow_interspersed_args is false, largs will always be</span>
        <span class="c"># *empty* -- still a subset of [arg0, ..., arg(i-1)], but</span>
        <span class="c"># not a very interesting subset!</span>

    <span class="k">def</span> <span class="nf">_match_long_opt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;_match_long_opt(opt : string) -&gt; string</span>

<span class="sd">        Determine which long option string &#39;opt&#39; matches, ie. which one</span>
<span class="sd">        it is an unambiguous abbreviation for.  Raises BadOptionError if</span>
<span class="sd">        &#39;opt&#39; doesn&#39;t unambiguously match any long option string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_match_abbrev</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_long_opt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_process_long_opt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rargs</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="n">rargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c"># Value explicitly attached to arg?  Pretend it&#39;s the next</span>
        <span class="c"># argument.</span>
        <span class="k">if</span> <span class="s">&quot;=&quot;</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">:</span>
            <span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">next_arg</span><span class="p">)</span> <span class="o">=</span> <span class="n">arg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;=&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">rargs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">next_arg</span><span class="p">)</span>
            <span class="n">had_explicit_value</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="n">arg</span>
            <span class="n">had_explicit_value</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_match_long_opt</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
        <span class="n">option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_long_opt</span><span class="p">[</span><span class="n">opt</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">option</span><span class="o">.</span><span class="n">takes_value</span><span class="p">():</span>
            <span class="n">nargs</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">nargs</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rargs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nargs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">ngettext</span><span class="p">(</span>
                    <span class="s">&quot;</span><span class="si">%(option)s</span><span class="s"> option requires </span><span class="si">%(number)d</span><span class="s"> argument&quot;</span><span class="p">,</span>
                    <span class="s">&quot;</span><span class="si">%(option)s</span><span class="s"> option requires </span><span class="si">%(number)d</span><span class="s"> arguments&quot;</span><span class="p">,</span>
                    <span class="n">nargs</span><span class="p">)</span> <span class="o">%</span> <span class="p">{</span><span class="s">&quot;option&quot;</span><span class="p">:</span> <span class="n">opt</span><span class="p">,</span> <span class="s">&quot;number&quot;</span><span class="p">:</span> <span class="n">nargs</span><span class="p">})</span>
            <span class="k">elif</span> <span class="n">nargs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">rargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">rargs</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nargs</span><span class="p">])</span>
                <span class="k">del</span> <span class="n">rargs</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nargs</span><span class="p">]</span>

        <span class="k">elif</span> <span class="n">had_explicit_value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> option does not take a value&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="n">opt</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">option</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_process_short_opts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rargs</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="n">rargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">arg</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">opt</span> <span class="o">=</span> <span class="s">&quot;-&quot;</span> <span class="o">+</span> <span class="n">ch</span>
            <span class="n">option</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_short_opt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>                      <span class="c"># we have consumed a character</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">option</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">BadOptionError</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">option</span><span class="o">.</span><span class="n">takes_value</span><span class="p">():</span>
                <span class="c"># Any characters left in arg?  Pretend they&#39;re the</span>
                <span class="c"># next arg, and stop consuming characters of arg.</span>
                <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
                    <span class="n">rargs</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">arg</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>
                    <span class="n">stop</span> <span class="o">=</span> <span class="bp">True</span>

                <span class="n">nargs</span> <span class="o">=</span> <span class="n">option</span><span class="o">.</span><span class="n">nargs</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rargs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">nargs</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">ngettext</span><span class="p">(</span>
                        <span class="s">&quot;</span><span class="si">%(option)s</span><span class="s"> option requires </span><span class="si">%(number)d</span><span class="s"> argument&quot;</span><span class="p">,</span>
                        <span class="s">&quot;</span><span class="si">%(option)s</span><span class="s"> option requires </span><span class="si">%(number)d</span><span class="s"> arguments&quot;</span><span class="p">,</span>
                        <span class="n">nargs</span><span class="p">)</span> <span class="o">%</span> <span class="p">{</span><span class="s">&quot;option&quot;</span><span class="p">:</span> <span class="n">opt</span><span class="p">,</span> <span class="s">&quot;number&quot;</span><span class="p">:</span> <span class="n">nargs</span><span class="p">})</span>
                <span class="k">elif</span> <span class="n">nargs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">rargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">rargs</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nargs</span><span class="p">])</span>
                    <span class="k">del</span> <span class="n">rargs</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">nargs</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>                       <span class="c"># option doesn&#39;t take a value</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="n">option</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">stop</span><span class="p">:</span>
                <span class="k">break</span>


    <span class="c"># -- Feedback methods ----------------------------------------------</span>

    <span class="k">def</span> <span class="nf">get_prog_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">prog</span>

    <span class="k">def</span> <span class="nf">expand_prog_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&quot;%prog&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_prog_name</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_prog_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">exit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;error(msg : string)</span>

<span class="sd">        Print a usage message incorporating &#39;msg&#39; to stderr and exit.</span>
<span class="sd">        If you override this in a subclass, it should not return -- it</span>
<span class="sd">        should either exit or raise an exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_usage</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">: error: </span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_prog_name</span><span class="p">(),</span> <span class="n">msg</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="o">.</span><span class="n">format_usage</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expand_prog_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">print_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;print_usage(file : file = stdout)</span>

<span class="sd">        Print the usage message for the current program (self.usage) to</span>
<span class="sd">        &#39;file&#39; (default stdout).  Any occurrence of the string &quot;%prog&quot; in</span>
<span class="sd">        self.usage is replaced with the name of the current program</span>
<span class="sd">        (basename of sys.argv[0]).  Does nothing if self.usage is empty</span>
<span class="sd">        or not defined.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_usage</span><span class="p">(),</span> <span class="nb">file</span><span class="o">=</span><span class="nb">file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_prog_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">print_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;print_version(file : file = stdout)</span>

<span class="sd">        Print the version message for this program (self.version) to</span>
<span class="sd">        &#39;file&#39; (default stdout).  As with print_usage(), any occurrence</span>
<span class="sd">        of &quot;%prog&quot; in self.version is replaced by the current program&#39;s</span>
<span class="sd">        name.  Does nothing if self.version is empty or undefined.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">version</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_version</span><span class="p">(),</span> <span class="nb">file</span><span class="o">=</span><span class="nb">file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format_option_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">formatter</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">store_option_strings</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">formatter</span><span class="o">.</span><span class="n">format_heading</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s">&quot;Options&quot;</span><span class="p">)))</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">indent</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_list</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">OptionContainer</span><span class="o">.</span><span class="n">format_option_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formatter</span><span class="p">))</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">option_groups</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">format_help</span><span class="p">(</span><span class="n">formatter</span><span class="p">))</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">formatter</span><span class="o">.</span><span class="n">dedent</span><span class="p">()</span>
        <span class="c"># Drop the last &quot;\n&quot;, or the header if no options or option groups:</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">format_epilog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formatter</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">formatter</span><span class="o">.</span><span class="n">format_epilog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epilog</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">format_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formatter</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">formatter</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">formatter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">usage</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_usage</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_description</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_option_help</span><span class="p">(</span><span class="n">formatter</span><span class="p">))</span>
        <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_epilog</span><span class="p">(</span><span class="n">formatter</span><span class="p">))</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">print_help</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;print_help(file : file = stdout)</span>

<span class="sd">        Print an extended help message, listing all options and any</span>
<span class="sd">        help text provided with them, to &#39;file&#39; (default stdout).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">file</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nb">file</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
        <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format_help</span><span class="p">())</span>

<span class="c"># class OptionParser</span>


<span class="k">def</span> <span class="nf">_match_abbrev</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">wordmap</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;_match_abbrev(s : string, wordmap : {string : Option}) -&gt; string</span>

<span class="sd">    Return the string key in &#39;wordmap&#39; for which &#39;s&#39; is an unambiguous</span>
<span class="sd">    abbreviation.  If &#39;s&#39; is found to be ambiguous or doesn&#39;t match any of</span>
<span class="sd">    &#39;words&#39;, raise BadOptionError.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Is there an exact match?</span>
    <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">wordmap</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c"># Isolate all words with s as a prefix.</span>
        <span class="n">possibilities</span> <span class="o">=</span> <span class="p">[</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">wordmap</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                         <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">s</span><span class="p">)]</span>
        <span class="c"># No exact match, so there had better be just one possibility.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">possibilities</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">possibilities</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">possibilities</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">BadOptionError</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># More than one possible completion: ambiguous prefix.</span>
            <span class="n">possibilities</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">AmbiguousOptionError</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">possibilities</span><span class="p">)</span>


<span class="c"># Some day, there might be many Option classes.  As of Optik 1.3, the</span>
<span class="c"># preferred way to instantiate Options is indirectly, via make_option(),</span>
<span class="c"># which will become a factory function when there are many Option</span>
<span class="c"># classes.</span>
<span class="n">make_option</span> <span class="o">=</span> <span class="n">Option</span>
</pre></div>

          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Bernhard F.W. Gschaider.
    </p>
  </div>

  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.6.6',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>