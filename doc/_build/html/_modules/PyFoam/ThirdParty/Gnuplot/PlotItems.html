

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>PyFoam.ThirdParty.Gnuplot.PlotItems &mdash; PyFoam 0.6.6 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="PyFoam 0.6.6 documentation" href="../../../../index.html"/>
        <link rel="up" title="PyFoam" href="../../../PyFoam.html"/> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html" class="icon icon-home"> PyFoam
          

          
          </a>

          
            
            
              <div class="version">
                0.6.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../api/modules.html">API documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../../index.html">PyFoam</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
      
          <li><a href="../../../PyFoam.html">PyFoam</a> &raquo;</li>
      
    <li>PyFoam.ThirdParty.Gnuplot.PlotItems</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for PyFoam.ThirdParty.Gnuplot.PlotItems</h1><div class="highlight"><pre>
<span></span><span class="c1"># $Id: PlotItems.py 299 2007-03-30 12:52:17Z mhagger $</span>

<span class="c1"># Copyright (C) 1998-2003 Michael Haggerty &lt;mhagger@alum.mit.edu&gt;</span>
<span class="c1">#</span>
<span class="c1"># This file is licensed under the GNU Lesser General Public License</span>
<span class="c1"># (LGPL).  See LICENSE.txt for details.</span>

<span class="sd">&quot;&quot;&quot;PlotItems.py -- Objects that can be plotted by Gnuplot.</span>

<span class="sd">This module contains several types of PlotItems.  PlotItems can be</span>
<span class="sd">plotted by passing them to a Gnuplot.Gnuplot object.  You can derive</span>
<span class="sd">your own classes from the PlotItem hierarchy to customize their</span>
<span class="sd">behavior.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">string</span><span class="o">,</span> <span class="nn">tempfile</span><span class="o">,</span> <span class="nn">types</span>

<span class="kn">from</span> <span class="nn">PyFoam.ThirdParty.six.moves</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">from</span> <span class="nn">PyFoam.ThirdParty.six</span> <span class="kn">import</span> <span class="n">string_types</span><span class="p">,</span><span class="n">integer_types</span>

<span class="c1">#try:</span>
<span class="c1">#    from cStringIO import StringIO</span>
<span class="c1">#except ImportError:</span>
<span class="c1">#    from StringIO import StringIO</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">numpy</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c1"># assume this is pypy and retry</span>
    <span class="kn">import</span> <span class="nn">numpypy</span>
    <span class="kn">import</span> <span class="nn">numpy</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">gp</span><span class="p">,</span> <span class="n">utils</span><span class="p">,</span> <span class="n">Errors</span>


<div class="viewcode-block" id="_unset"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems._unset">[docs]</a><span class="k">class</span> <span class="nc">_unset</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Used to represent unset keyword arguments.&quot;&quot;&quot;</span>

    <span class="k">pass</span></div>


<div class="viewcode-block" id="PlotItem"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems.PlotItem">[docs]</a><span class="k">class</span> <span class="nc">PlotItem</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Plotitem represents an item that can be plotted by gnuplot.</span>

<span class="sd">    For the finest control over the output, you can create &#39;PlotItems&#39;</span>
<span class="sd">    yourself with additional keyword options, or derive new classes</span>
<span class="sd">    from &#39;PlotItem&#39;.</span>

<span class="sd">    The handling of options is complicated by the attempt to allow</span>
<span class="sd">    options and their setting mechanism to be inherited conveniently.</span>
<span class="sd">    Note first that there are some options that can only be set in the</span>
<span class="sd">    constructor then never modified, and others that can be set in the</span>
<span class="sd">    constructor and/or modified using the &#39;set_option()&#39; member</span>
<span class="sd">    function.  The former are always processed within &#39;__init__&#39;.  The</span>
<span class="sd">    latter are always processed within &#39;set_option&#39;, which is called</span>
<span class="sd">    by the constructor.</span>

<span class="sd">    &#39;set_option&#39; is driven by a class-wide dictionary called</span>
<span class="sd">    &#39;_option_list&#39;, which is a mapping &#39;{ &lt;option&gt; : &lt;setter&gt; }&#39; from</span>
<span class="sd">    option name to the function object used to set or change the</span>
<span class="sd">    option.  &lt;setter&gt; is a function object that takes two parameters:</span>
<span class="sd">    &#39;self&#39; (the &#39;PlotItem&#39; instance) and the new value requested for</span>
<span class="sd">    the option.  If &lt;setter&gt; is &#39;None&#39;, then the option is not allowed</span>
<span class="sd">    to be changed after construction and an exception is raised.</span>

<span class="sd">    Any &#39;PlotItem&#39; that needs to add options can add to this</span>
<span class="sd">    dictionary within its class definition.  Follow one of the</span>
<span class="sd">    examples in this file.  Alternatively it could override the</span>
<span class="sd">    &#39;set_option&#39; member function if it needs to do wilder things.</span>

<span class="sd">    Members:</span>

<span class="sd">      &#39;_basecommand&#39; -- a string holding the elementary argument that</span>
<span class="sd">          must be passed to gnuplot&#39;s `plot&#39; command for this item;</span>
<span class="sd">          e.g., &#39;sin(x)&#39; or &#39;&quot;filename.dat&quot;&#39;.</span>

<span class="sd">      &#39;_options&#39; -- a dictionary of (&lt;option&gt;,&lt;string&gt;) tuples</span>
<span class="sd">          corresponding to the plot options that have been set for</span>
<span class="sd">          this instance of the PlotItem.  &lt;option&gt; is the option as</span>
<span class="sd">          specified by the user; &lt;string&gt; is the string that needs to</span>
<span class="sd">          be set in the command line to set that option (or None if no</span>
<span class="sd">          string is needed).  Example::</span>

<span class="sd">              {&#39;title&#39; : (&#39;Data&#39;, &#39;title &quot;Data&quot;&#39;),</span>
<span class="sd">               &#39;with&#39; : (&#39;linespoints&#39;, &#39;with linespoints&#39;)}</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># For _option_list explanation, see docstring for PlotItem.</span>
    <span class="n">_option_list</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;axes&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_string_option</span><span class="p">(</span>
            <span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">axes</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;axes </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">),</span>
        <span class="s1">&#39;with&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">with_</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_string_option</span><span class="p">(</span>
            <span class="s1">&#39;with&#39;</span><span class="p">,</span> <span class="n">with_</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;with </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">),</span>
        <span class="s1">&#39;title&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_string_option</span><span class="p">(</span>
            <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="s1">&#39;notitle&#39;</span><span class="p">,</span> <span class="s1">&#39;title &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span><span class="p">),</span>
        <span class="p">}</span>
    <span class="n">_option_list</span><span class="p">[</span><span class="s1">&#39;with_&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_option_list</span><span class="p">[</span><span class="s1">&#39;with&#39;</span><span class="p">]</span>

    <span class="c1"># order in which options need to be passed to gnuplot:</span>
    <span class="n">_option_sequence</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;binary&#39;</span><span class="p">,</span>
        <span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;every&#39;</span><span class="p">,</span> <span class="s1">&#39;thru&#39;</span><span class="p">,</span> <span class="s1">&#39;using&#39;</span><span class="p">,</span> <span class="s1">&#39;smooth&#39;</span><span class="p">,</span>
        <span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;with&#39;</span>
        <span class="p">]</span>

<div class="viewcode-block" id="PlotItem.__init__"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems.PlotItem.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Construct a &#39;PlotItem&#39;.</span>

<span class="sd">        Keyword options:</span>

<span class="sd">          &#39;with_=&lt;string&gt;&#39; -- choose how item will be plotted, e.g.,</span>
<span class="sd">              with_=&#39;points 3 3&#39;.</span>

<span class="sd">          &#39;title=&lt;string&gt;&#39; -- set the title to be associated with the item</span>
<span class="sd">              in the plot legend.</span>

<span class="sd">          &#39;title=None&#39; -- choose &#39;notitle&#39; option (omit item from legend).</span>

<span class="sd">        Note that omitting the title option is different than setting</span>
<span class="sd">        &#39;title=None&#39;; the former chooses gnuplot&#39;s default whereas the</span>
<span class="sd">        latter chooses &#39;notitle&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="o">**</span><span class="n">keyw</span><span class="p">)</span></div>

<div class="viewcode-block" id="PlotItem.get_option"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems.PlotItem.get_option">[docs]</a>    <span class="k">def</span> <span class="nf">get_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the setting of an option.  May be overridden.&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s1">&#39;option </span><span class="si">%s</span><span class="s1"> is not set!&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="PlotItem.set_option"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems.PlotItem.set_option">[docs]</a>    <span class="k">def</span> <span class="nf">set_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set or change a plot option for this PlotItem.</span>

<span class="sd">        See documentation for &#39;__init__&#39; for information about allowed</span>
<span class="sd">        options.  This function can be overridden by derived classes</span>
<span class="sd">        to allow additional options, in which case those options will</span>
<span class="sd">        also be allowed by &#39;__init__&#39; for the derived class.  However,</span>
<span class="sd">        it is easier to define a new &#39;_option_list&#39; variable for the</span>
<span class="sd">        derived class.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">keyw</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">setter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_list</span><span class="p">[</span><span class="n">option</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">OptionError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">option</span><span class="p">,</span><span class="n">value</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">setter</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">OptionError</span><span class="p">(</span>
                    <span class="s1">&#39;Cannot modify </span><span class="si">%s</span><span class="s1"> option after construction!&#39;</span><span class="p">,</span> <span class="n">option</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">setter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="PlotItem.set_string_option"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems.PlotItem.set_string_option">[docs]</a>    <span class="k">def</span> <span class="nf">set_string_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="p">,</span> <span class="n">fmt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set an option that takes a string value.&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">option</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">string_types</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">option</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">fmt</span> <span class="o">%</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Errors</span><span class="o">.</span><span class="n">OptionError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">value</span><span class="p">,))</span></div>

<div class="viewcode-block" id="PlotItem.clear_option"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems.PlotItem.clear_option">[docs]</a>    <span class="k">def</span> <span class="nf">clear_option</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clear (unset) a plot option.  No error if option was not set.&quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="PlotItem.get_base_command_string"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems.PlotItem.get_base_command_string">[docs]</a>    <span class="k">def</span> <span class="nf">get_base_command_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">()</span></div>

<div class="viewcode-block" id="PlotItem.get_command_option_string"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems.PlotItem.get_command_option_string">[docs]</a>    <span class="k">def</span> <span class="nf">get_command_option_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_option_sequence</span><span class="p">:</span>
            <span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">str</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">cmd</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span></div>

<div class="viewcode-block" id="PlotItem.command"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems.PlotItem.command">[docs]</a>    <span class="k">def</span> <span class="nf">command</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Build the plot command to be sent to gnuplot.</span>

<span class="sd">        Build and return the plot command, with options, necessary to</span>
<span class="sd">        display this item.  If anything else needs to be done once per</span>
<span class="sd">        plot, it can be done here too.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_base_command_string</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_command_option_string</span><span class="p">(),</span>
            <span class="p">])</span></div>

<div class="viewcode-block" id="PlotItem.pipein"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems.PlotItem.pipein">[docs]</a>    <span class="k">def</span> <span class="nf">pipein</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Pipe necessary inline data to gnuplot.</span>

<span class="sd">        If the plot command requires data to be put on stdin (i.e.,</span>
<span class="sd">        &#39;plot &quot;-&quot;&#39;), this method should put that data there.  Can be</span>
<span class="sd">        overridden in derived classes.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="Func"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems.Func">[docs]</a><span class="k">class</span> <span class="nc">Func</span><span class="p">(</span><span class="n">PlotItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents a mathematical expression to plot.</span>

<span class="sd">    Func represents a mathematical expression that is to be computed by</span>
<span class="sd">    gnuplot itself, as if you would type for example::</span>

<span class="sd">        gnuplot&gt; plot sin(x)</span>

<span class="sd">    into gnuplot itself.  The argument to the contructor is a string</span>
<span class="sd">    that should be a mathematical expression.  Example::</span>

<span class="sd">        g.plot(Func(&#39;sin(x)&#39;, with_=&#39;line 3&#39;))</span>

<span class="sd">    As shorthand, a string passed to the plot method of a Gnuplot</span>
<span class="sd">    object is also treated as a Func::</span>

<span class="sd">        g.plot(&#39;sin(x)&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Func.__init__"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems.Func.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">):</span>
        <span class="n">PlotItem</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">function</span></div>

<div class="viewcode-block" id="Func.get_base_command_string"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems.Func.get_base_command_string">[docs]</a>    <span class="k">def</span> <span class="nf">get_base_command_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span></div></div>


<div class="viewcode-block" id="_FileItem"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems._FileItem">[docs]</a><span class="k">class</span> <span class="nc">_FileItem</span><span class="p">(</span><span class="n">PlotItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A PlotItem representing a file that contains gnuplot data.</span>

<span class="sd">    This class is not meant for users but rather as a base class for</span>
<span class="sd">    other types of FileItem.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_option_list</span> <span class="o">=</span> <span class="n">PlotItem</span><span class="o">.</span><span class="n">_option_list</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">_option_list</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;binary&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">binary</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_option_binary</span><span class="p">(</span><span class="n">binary</span><span class="p">),</span>
        <span class="s1">&#39;index&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_option_colonsep</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span>
        <span class="s1">&#39;every&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_option_colonsep</span><span class="p">(</span><span class="s1">&#39;every&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span>
        <span class="s1">&#39;using&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_option_colonsep</span><span class="p">(</span><span class="s1">&#39;using&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span>
        <span class="s1">&#39;smooth&#39;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">smooth</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_string_option</span><span class="p">(</span>
            <span class="s1">&#39;smooth&#39;</span><span class="p">,</span> <span class="n">smooth</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="s1">&#39;smooth </span><span class="si">%s</span><span class="s1">&#39;</span>
            <span class="p">),</span>
        <span class="p">})</span>

<div class="viewcode-block" id="_FileItem.__init__"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems._FileItem.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Represent a PlotItem that gnuplot treates as a file.</span>

<span class="sd">        This class holds the information that is needed to construct</span>
<span class="sd">        the plot command line, including options that are specific to</span>
<span class="sd">        file-like gnuplot input.</span>

<span class="sd">        &lt;filename&gt; is a string representing the filename to be passed</span>
<span class="sd">        to gnuplot within quotes.  It may be the name of an existing</span>
<span class="sd">        file, &#39;-&#39; for inline data, or the name of a named pipe.</span>

<span class="sd">        Keyword arguments:</span>

<span class="sd">            &#39;using=&lt;int&gt;&#39; -- plot that column against line number</span>

<span class="sd">            &#39;using=&lt;tuple&gt;&#39; -- plot using a:b:c:d etc.  Elements in</span>
<span class="sd">                the tuple that are None are output as the empty</span>
<span class="sd">                string.</span>

<span class="sd">            &#39;using=&lt;string&gt;&#39; -- plot `using &lt;string&gt;&#39; (allows gnuplot&#39;s</span>
<span class="sd">                arbitrary column arithmetic)</span>

<span class="sd">            &#39;every=&lt;value&gt;&#39; -- plot &#39;every &lt;value&gt;&#39;.  &lt;value&gt; is</span>
<span class="sd">                formatted as for &#39;using&#39; option.</span>

<span class="sd">            &#39;index=&lt;value&gt;&#39; -- plot &#39;index &lt;value&gt;&#39;.  &lt;value&gt; is</span>
<span class="sd">                formatted as for &#39;using&#39; option.</span>

<span class="sd">            &#39;binary=&lt;boolean&gt;&#39; -- data in the file is in binary format</span>
<span class="sd">                (this option is only allowed for grid data for splot).</span>

<span class="sd">            &#39;smooth=&lt;string&gt;&#39; -- smooth the data.  Option should be</span>
<span class="sd">                &#39;unique&#39;, &#39;csplines&#39;, &#39;acsplines&#39;, &#39;bezier&#39;, or</span>
<span class="sd">                &#39;sbezier&#39;.</span>

<span class="sd">        The keyword arguments recognized by &#39;PlotItem&#39; can also be</span>
<span class="sd">        used here.</span>

<span class="sd">        Note that the &#39;using&#39; option is interpreted by gnuplot, so</span>
<span class="sd">        columns must be numbered starting with 1.</span>

<span class="sd">        By default, gnuplot uses the name of the file plus any &#39;using&#39;</span>
<span class="sd">        option as the dataset title.  If you want another title, set</span>
<span class="sd">        it explicitly using the &#39;title&#39; option.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="n">PlotItem</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">)</span></div>

<div class="viewcode-block" id="_FileItem.get_base_command_string"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems._FileItem.get_base_command_string">[docs]</a>    <span class="k">def</span> <span class="nf">get_base_command_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">gp</span><span class="o">.</span><span class="n">double_quote_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span></div>

<div class="viewcode-block" id="_FileItem.set_option_colonsep"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems._FileItem.set_option_colonsep">[docs]</a>    <span class="k">def</span> <span class="nf">set_option_colonsep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear_option</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,(</span><span class="n">string_types</span><span class="o">+</span><span class="n">integer_types</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,))</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="n">subopts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">subopt</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">subopt</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">subopts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">subopts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">subopt</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">value</span><span class="p">,</span>
                <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subopts</span><span class="p">),),</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">OptionError</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,))</span></div>

<div class="viewcode-block" id="_FileItem.set_option_binary"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems._FileItem.set_option_binary">[docs]</a>    <span class="k">def</span> <span class="nf">set_option_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">binary</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">binary</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gp</span><span class="o">.</span><span class="n">GnuplotOpts</span><span class="o">.</span><span class="n">recognizes_binary_splot</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">OptionError</span><span class="p">(</span>
                    <span class="s1">&#39;Gnuplot.py is currently configured to reject binary data&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;binary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;binary&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_options</span><span class="p">[</span><span class="s1">&#39;binary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="_NewFileItem"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems._NewFileItem">[docs]</a><span class="k">class</span> <span class="nc">_NewFileItem</span><span class="p">(</span><span class="n">_FileItem</span><span class="p">):</span>
<div class="viewcode-block" id="_NewFileItem.__init__"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems._NewFileItem.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">):</span>

        <span class="n">binary</span> <span class="o">=</span> <span class="n">keyw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">binary</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;wb&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span>

        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="c1"># This is a permanent file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temp</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">temp</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tempfile</span><span class="p">,</span> <span class="s1">&#39;mkstemp&#39;</span><span class="p">):</span>
                <span class="c1"># Use the new secure method of creating temporary files:</span>
                <span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">filename</span><span class="p">,)</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span>
                    <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.gnuplot&#39;</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="p">(</span><span class="ow">not</span> <span class="n">binary</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># for backwards compatibility to pre-2.3:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mktemp</span><span class="p">()</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># If the user hasn&#39;t specified a title, set it to None so</span>
        <span class="c1"># that the name of the temporary file is not used:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp</span> <span class="ow">and</span> <span class="s1">&#39;title&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keyw</span><span class="p">:</span>
            <span class="n">keyw</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">_FileItem</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">)</span></div>

<div class="viewcode-block" id="_NewFileItem.__del__"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems._NewFileItem.__del__">[docs]</a>    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">temp</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="_InlineFileItem"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems._InlineFileItem">[docs]</a><span class="k">class</span> <span class="nc">_InlineFileItem</span><span class="p">(</span><span class="n">_FileItem</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A _FileItem that actually indicates inline data.</span>

<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="_InlineFileItem.__init__"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems._InlineFileItem.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">):</span>
        <span class="c1"># If the user hasn&#39;t specified a title, set it to None so that</span>
        <span class="c1"># &#39;-&#39; is not used:</span>
        <span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keyw</span><span class="p">:</span>
            <span class="n">keyw</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">keyw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">OptionError</span><span class="p">(</span><span class="s1">&#39;binary inline data is not supported&#39;</span><span class="p">)</span>

        <span class="n">_FileItem</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">content</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span></div>

<div class="viewcode-block" id="_InlineFileItem.pipein"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems._InlineFileItem.pipein">[docs]</a>    <span class="k">def</span> <span class="nf">pipein</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">+</span> <span class="s1">&#39;e</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span></div></div>


<span class="k">if</span> <span class="n">gp</span><span class="o">.</span><span class="n">GnuplotOpts</span><span class="o">.</span><span class="n">support_fifo</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">threading</span>

<div class="viewcode-block" id="_FIFOWriter"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems._FIFOWriter">[docs]</a>    <span class="k">class</span> <span class="nc">_FIFOWriter</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a FIFO (named pipe), write to it, then delete it.</span>

<span class="sd">        The writing takes place in a separate thread so that the main</span>
<span class="sd">        thread is not blocked.  The idea is that once the writing is</span>
<span class="sd">        finished we know that gnuplot is done with the data that were in</span>
<span class="sd">        the file so we can delete the file.  This technique removes the</span>
<span class="sd">        ambiguity about when the temporary files should be deleted.</span>

<span class="sd">        Since the tempfile module does not provide an easy, secure way</span>
<span class="sd">        to create a FIFO without race conditions, we instead create a</span>
<span class="sd">        temporary directory using mkdtemp() then create the FIFO</span>
<span class="sd">        within that directory.  When the writer thread has written the</span>
<span class="sd">        full information to the FIFO, it deletes both the FIFO and the</span>
<span class="sd">        temporary directory that contained it.</span>

<span class="sd">        &quot;&quot;&quot;</span>

<div class="viewcode-block" id="_FIFOWriter.__init__"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems._FIFOWriter.__init__">[docs]</a>        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">tempfile</span><span class="p">,</span> <span class="s1">&#39;mkdtemp&#39;</span><span class="p">):</span>
                <span class="c1"># Make the file within a temporary directory that is</span>
                <span class="c1"># created securely:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkdtemp</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.gnuplot&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">,</span> <span class="s1">&#39;fifo&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># For backwards compatibility pre-2.3, just use</span>
                <span class="c1"># mktemp() to create filename:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mktemp</span><span class="p">()</span>
            <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;FIFO Writer for </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,)),</span>
                <span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkfifo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>

<div class="viewcode-block" id="_FIFOWriter.run"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems._FIFOWriter.run">[docs]</a>        <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">rmdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="_FIFOFileItem"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems._FIFOFileItem">[docs]</a>    <span class="k">class</span> <span class="nc">_FIFOFileItem</span><span class="p">(</span><span class="n">_FileItem</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A _FileItem based on a FIFO (named pipe).</span>

<span class="sd">        This class depends on the availablity of os.mkfifo(), which only</span>
<span class="sd">        exists under Unix.</span>

<span class="sd">        &quot;&quot;&quot;</span>

<div class="viewcode-block" id="_FIFOFileItem.__init__"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems._FIFOFileItem.__init__">[docs]</a>        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">):</span>
            <span class="c1"># If the user hasn&#39;t specified a title, set it to None so that</span>
            <span class="c1"># the name of the temporary FIFO is not used:</span>
            <span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">keyw</span><span class="p">:</span>
                <span class="n">keyw</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="n">_FileItem</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>
            <span class="k">if</span> <span class="n">keyw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;wb&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span></div>

<div class="viewcode-block" id="_FIFOFileItem.get_base_command_string"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems._FIFOFileItem.get_base_command_string">[docs]</a>        <span class="k">def</span> <span class="nf">get_base_command_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Create the gnuplot command for plotting this item.</span>

<span class="sd">            The basecommand is different each time because each FIFOWriter</span>
<span class="sd">            creates a new FIFO.</span>

<span class="sd">            &quot;&quot;&quot;</span>

            <span class="c1"># Create a new FIFO and a thread to write to it.  Retrieve the</span>
            <span class="c1"># filename of the FIFO to be used in the basecommand.</span>
            <span class="n">fifo</span> <span class="o">=</span> <span class="n">_FIFOWriter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">gp</span><span class="o">.</span><span class="n">double_quote_string</span><span class="p">(</span><span class="n">fifo</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="File"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems.File">[docs]</a><span class="k">def</span> <span class="nf">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Construct a _FileItem object referring to an existing file.</span>

<span class="sd">    This is a convenience function that just returns a _FileItem that</span>
<span class="sd">    wraps the filename.</span>

<span class="sd">    &lt;filename&gt; is a string holding the filename of an existing file.</span>
<span class="sd">    The keyword arguments are the same as those of the _FileItem</span>
<span class="sd">    constructor.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">string_types</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">OptionError</span><span class="p">(</span>
            <span class="s1">&#39;Argument (</span><span class="si">%s</span><span class="s1">) must be a filename&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">filename</span><span class="p">,)</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">_FileItem</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">)</span></div>


<div class="viewcode-block" id="Data"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems.Data">[docs]</a><span class="k">def</span> <span class="nf">Data</span><span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Create and return a _FileItem representing the data from *data.</span>

<span class="sd">    Create a &#39;_FileItem&#39; object (which is a type of &#39;PlotItem&#39;) out of</span>
<span class="sd">    one or more Float Python numpy arrays (or objects that can be</span>
<span class="sd">    converted to a float numpy array).  If the routine is passed a</span>
<span class="sd">    single with multiple dimensions, then the last index ranges over</span>
<span class="sd">    the values comprising a single data point (e.g., [&lt;x&gt;, &lt;y&gt;,</span>
<span class="sd">    &lt;sigma&gt;]) and the rest of the indices select the data point.  If</span>
<span class="sd">    passed a single array with 1 dimension, then each point is</span>
<span class="sd">    considered to have only one value (i.e., by default the values</span>
<span class="sd">    will be plotted against their indices).  If the routine is passed</span>
<span class="sd">    more than one array, they must have identical shapes, and then</span>
<span class="sd">    each data point is composed of one point from each array.  E.g.,</span>
<span class="sd">    &#39;Data(x,x**2)&#39; is a &#39;PlotItem&#39; that represents x squared as a</span>
<span class="sd">    function of x.  For the output format, see the comments for</span>
<span class="sd">    &#39;write_array()&#39;.</span>

<span class="sd">    How the data are written to gnuplot depends on the &#39;inline&#39;</span>
<span class="sd">    argument and preference settings for the platform in use.</span>

<span class="sd">    Keyword arguments:</span>

<span class="sd">        &#39;cols=&lt;tuple&gt;&#39; -- write only the specified columns from each</span>
<span class="sd">            data point to the file.  Since cols is used by python, the</span>
<span class="sd">            columns should be numbered in the python style (starting</span>
<span class="sd">            from 0), not the gnuplot style (starting from 1).</span>

<span class="sd">        &#39;inline=&lt;bool&gt;&#39; -- transmit the data to gnuplot &#39;inline&#39;</span>
<span class="sd">            rather than through a temporary file.  The default is the</span>
<span class="sd">            value of gp.GnuplotOpts.prefer_inline_data.</span>

<span class="sd">        &#39;filename=&lt;string&gt;&#39; -- save data to a permanent file.</span>

<span class="sd">    The keyword arguments recognized by &#39;_FileItem&#39; can also be used</span>
<span class="sd">    here.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># data was passed as a single structure</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">float_array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># As a special case, if passed a single 1-D array, then it is</span>
        <span class="c1"># treated as one value per point (by default, plotted against</span>
        <span class="c1"># its index):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span><span class="n">numpy</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># data was passed column by column (for example,</span>
        <span class="c1"># Data(x,y)); pack it into one big array (this will test</span>
        <span class="c1"># that sizes are all the same):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">float_array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="c1"># transpose so that the last index selects x vs. y:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">dims</span><span class="o">-</span><span class="mi">1</span><span class="p">,)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">dims</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>
    <span class="k">if</span> <span class="s1">&#39;cols&#39;</span> <span class="ow">in</span> <span class="n">keyw</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">keyw</span><span class="p">[</span><span class="s1">&#39;cols&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">keyw</span><span class="p">[</span><span class="s1">&#39;cols&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cols</span><span class="p">,</span> <span class="n">integer_types</span><span class="p">):</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="p">(</span><span class="n">cols</span><span class="p">,)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;filename&#39;</span> <span class="ow">in</span> <span class="n">keyw</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">keyw</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">None</span>
        <span class="k">del</span> <span class="n">keyw</span><span class="p">[</span><span class="s1">&#39;filename&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">None</span>

    <span class="k">if</span> <span class="s1">&#39;inline&#39;</span> <span class="ow">in</span> <span class="n">keyw</span><span class="p">:</span>
        <span class="n">inline</span> <span class="o">=</span> <span class="n">keyw</span><span class="p">[</span><span class="s1">&#39;inline&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">keyw</span><span class="p">[</span><span class="s1">&#39;inline&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">inline</span> <span class="ow">and</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">OptionError</span><span class="p">(</span>
                <span class="s1">&#39;cannot pass data both inline and via a file&#39;</span>
                <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">inline</span> <span class="o">=</span> <span class="p">(</span><span class="ow">not</span> <span class="n">filename</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gp</span><span class="o">.</span><span class="n">GnuplotOpts</span><span class="o">.</span><span class="n">prefer_inline_data</span>

    <span class="c1"># Output the content into a string:</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
    <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">inline</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_InlineFileItem</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">filename</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_NewFileItem</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">gp</span><span class="o">.</span><span class="n">GnuplotOpts</span><span class="o">.</span><span class="n">prefer_fifo_data</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_FIFOFileItem</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_NewFileItem</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">)</span></div>


<div class="viewcode-block" id="GridData"><a class="viewcode-back" href="../../../../api/PyFoam.ThirdParty.Gnuplot.PlotItems.html#PyFoam.ThirdParty.Gnuplot.PlotItems.GridData">[docs]</a><span class="k">def</span> <span class="nf">GridData</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span> <span class="n">xvals</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yvals</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="n">_unset</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span>
    <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return a _FileItem representing a function of two variables.</span>

<span class="sd">    &#39;GridData&#39; represents a function that has been tabulated on a</span>
<span class="sd">    rectangular grid.  The data are written to a file; no copy is kept</span>
<span class="sd">    in memory.</span>

<span class="sd">    Arguments:</span>

<span class="sd">        &#39;data&#39; -- the data to plot: a 2-d array with dimensions</span>
<span class="sd">            (numx,numy).</span>

<span class="sd">        &#39;xvals&#39; -- a 1-d array with dimension &#39;numx&#39;</span>

<span class="sd">        &#39;yvals&#39; -- a 1-d array with dimension &#39;numy&#39;</span>

<span class="sd">        &#39;binary=&lt;bool&gt;&#39; -- send data to gnuplot in binary format?</span>

<span class="sd">        &#39;inline=&lt;bool&gt;&#39; -- send data to gnuplot &quot;inline&quot;?</span>

<span class="sd">        &#39;filename=&lt;string&gt;&#39; -- save data to a permanent file.</span>

<span class="sd">    Note the unusual argument order!  The data are specified *before*</span>
<span class="sd">    the x and y values.  (This inconsistency was probably a mistake;</span>
<span class="sd">    after all, the default xvals and yvals are not very useful.)</span>

<span class="sd">    &#39;data&#39; must be a data array holding the values of a function</span>
<span class="sd">    f(x,y) tabulated on a grid of points, such that &#39;data[i,j] ==</span>
<span class="sd">    f(xvals[i], yvals[j])&#39;.  If &#39;xvals&#39; and/or &#39;yvals&#39; are omitted,</span>
<span class="sd">    integers (starting with 0) are used for that coordinate.  The data</span>
<span class="sd">    are written to a temporary file; no copy of the data is kept in</span>
<span class="sd">    memory.</span>

<span class="sd">    If &#39;binary=0&#39; then the data are written to a datafile as &#39;x y</span>
<span class="sd">    f(x,y)&#39; triplets (y changes most rapidly) that can be used by</span>
<span class="sd">    gnuplot&#39;s &#39;splot&#39; command.  Blank lines are included each time the</span>
<span class="sd">    value of x changes so that gnuplot knows to plot a surface through</span>
<span class="sd">    the data.</span>

<span class="sd">    If &#39;binary=1&#39; then the data are written to a file in a binary</span>
<span class="sd">    format that &#39;splot&#39; can understand.  Binary format is faster and</span>
<span class="sd">    usually saves disk space but is not human-readable.  If your</span>
<span class="sd">    version of gnuplot doesn&#39;t support binary format (it is a</span>
<span class="sd">    recently-added feature), this behavior can be disabled by setting</span>
<span class="sd">    the configuration variable</span>
<span class="sd">    &#39;gp.GnuplotOpts.recognizes_binary_splot=0&#39; in the appropriate</span>
<span class="sd">    gp*.py file.</span>

<span class="sd">    Thus if you have three arrays in the above format and a Gnuplot</span>
<span class="sd">    instance called g, you can plot your data by typing</span>
<span class="sd">    &#39;g.splot(Gnuplot.GridData(data,xvals,yvals))&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Try to interpret data as an array:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">float_array</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="p">(</span><span class="n">numx</span><span class="p">,</span> <span class="n">numy</span><span class="p">)</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">DataError</span><span class="p">(</span><span class="s1">&#39;data array must be two-dimensional&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xvals</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">xvals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">numx</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xvals</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">float_array</span><span class="p">(</span><span class="n">xvals</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xvals</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="n">numx</span><span class="p">,):</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">DataError</span><span class="p">(</span>
                <span class="s1">&#39;The size of xvals must be the same as the size of &#39;</span>
                <span class="s1">&#39;the first dimension of the data array&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">yvals</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">yvals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">numy</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">yvals</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">float_array</span><span class="p">(</span><span class="n">yvals</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">yvals</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="p">(</span><span class="n">numy</span><span class="p">,):</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">DataError</span><span class="p">(</span>
                <span class="s1">&#39;The size of yvals must be the same as the size of &#39;</span>
                <span class="s1">&#39;the second dimension of the data array&#39;</span><span class="p">)</span>

    <span class="c1"># Binary defaults to true if recognizes_binary_plot is set;</span>
    <span class="c1"># otherwise it is forced to false.</span>
    <span class="n">binary</span> <span class="o">=</span> <span class="n">keyw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gp</span><span class="o">.</span><span class="n">GnuplotOpts</span><span class="o">.</span><span class="n">recognizes_binary_splot</span>
    <span class="n">keyw</span><span class="p">[</span><span class="s1">&#39;binary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">binary</span>

    <span class="k">if</span> <span class="n">inline</span> <span class="ow">is</span> <span class="n">_unset</span><span class="p">:</span>
        <span class="n">inline</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">(</span><span class="ow">not</span> <span class="n">binary</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">filename</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">gp</span><span class="o">.</span><span class="n">GnuplotOpts</span><span class="o">.</span><span class="n">prefer_inline_data</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">inline</span> <span class="ow">and</span> <span class="n">filename</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">OptionError</span><span class="p">(</span>
            <span class="s1">&#39;cannot pass data both inline and via a file&#39;</span>
            <span class="p">)</span>

    <span class="c1"># xvals, yvals, and data are now all filled with arrays of data.</span>
    <span class="k">if</span> <span class="n">binary</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">inline</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">Errors</span><span class="o">.</span><span class="n">OptionError</span><span class="p">(</span><span class="s1">&#39;binary inline data not supported&#39;</span><span class="p">)</span>

        <span class="c1"># write file in binary format</span>

        <span class="c1"># It seems that the gnuplot documentation for binary mode</span>
        <span class="c1"># disagrees with its actual behavior (as of v. 3.7).  The</span>
        <span class="c1"># documentation has the roles of x and y exchanged.  We ignore</span>
        <span class="c1"># the documentation and go with the code.</span>

        <span class="n">mout</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">numy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">numx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">mout</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">numx</span>
        <span class="n">mout</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">xvals</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">mout</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">yvals</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># try copying without the additional copy implied by astype():</span>
            <span class="n">mout</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c1"># if that didn&#39;t work then downcasting from double</span>
            <span class="c1"># must be necessary:</span>
            <span class="n">mout</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">float32</span><span class="p">))</span>

        <span class="n">content</span> <span class="o">=</span> <span class="n">mout</span><span class="o">.</span><span class="n">tostring</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">filename</span><span class="p">)</span> <span class="ow">and</span> <span class="n">gp</span><span class="o">.</span><span class="n">GnuplotOpts</span><span class="o">.</span><span class="n">prefer_fifo_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_FIFOFileItem</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_NewFileItem</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># output data to file as &quot;x y f(x)&quot; triplets.  This</span>
        <span class="c1"># requires numy copies of each x value and numx copies of</span>
        <span class="c1"># each y value.  First reformat the data:</span>
        <span class="nb">set</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span>
            <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">xvals</span><span class="p">,</span> <span class="p">(</span><span class="n">numy</span><span class="p">,</span> <span class="n">numx</span><span class="p">))),</span>
                 <span class="n">numpy</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">yvals</span><span class="p">,</span> <span class="p">(</span><span class="n">numx</span><span class="p">,</span> <span class="n">numy</span><span class="p">)),</span>
                 <span class="n">data</span><span class="p">)),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>

        <span class="c1"># Now output the data with the usual routine.  This will</span>
        <span class="c1"># produce data properly formatted in blocks separated by blank</span>
        <span class="c1"># lines so that gnuplot can connect the points into a grid.</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">write_array</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">set</span><span class="p">)</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">inline</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_InlineFileItem</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_NewFileItem</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">gp</span><span class="o">.</span><span class="n">GnuplotOpts</span><span class="o">.</span><span class="n">prefer_fifo_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_FIFOFileItem</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_NewFileItem</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="o">**</span><span class="n">keyw</span><span class="p">)</span></div>

<span class="c1"># Should work with Python3 and Python2</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Bernhard F.W. Gschaider.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'0.6.6',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>